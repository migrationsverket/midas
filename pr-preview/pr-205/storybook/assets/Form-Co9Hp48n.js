import{A as b,j,B as T,o as U,f as P}from"./useFocusable-D_XT9yGL.js";import{r,R as D}from"./index-ClcD9ViR.js";import{a as N}from"./Text-BU-eztOh.js";function ee(a,e,t){let i=r.useRef(e),n=b(()=>{t&&t(i.current)});r.useEffect(()=>{var l;let o=a==null||(l=a.current)===null||l===void 0?void 0:l.form;return o==null||o.addEventListener("reset",n),()=>{o==null||o.removeEventListener("reset",n)}},[a,n])}const I={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},w={...I,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:I,validationErrors:[]},Q=r.createContext({}),C="__formValidationState"+Date.now();function te(a){if(a[C]){let{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:n,commitValidation:l}=a[C];return{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:n,commitValidation:l}}return _(a)}function _(a){let{isInvalid:e,validationState:t,name:i,value:n,builtinValidation:l,validate:o,validationBehavior:u="aria"}=a;t&&(e||(e=t==="invalid"));let d=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:w}:null,v=r.useMemo(()=>{if(!o||n==null)return null;let s=k(o,n);return L(s)},[o,n]);l!=null&&l.validationDetails.valid&&(l=void 0);let c=r.useContext(Q),f=r.useMemo(()=>i?Array.isArray(i)?i.flatMap(s=>x(c[s])):x(c[i]):[],[c,i]),[R,B]=r.useState(c),[M,V]=r.useState(!1);c!==R&&(B(c),V(!1));let E=r.useMemo(()=>L(M?[]:f),[M,f]),S=r.useRef($),[p,g]=r.useState($),m=r.useRef($),F=()=>{if(!O)return;h(!1);let s=v||l||S.current;y(s,m.current)||(m.current=s,g(s))},[O,h]=r.useState(!1);return r.useEffect(F),{realtimeValidation:d||E||v||l||$,displayValidation:u==="native"?d||E||p:d||E||v||l||p,updateValidation(s){u==="aria"&&!y(p,s)?g(s):S.current=s},resetValidation(){let s=$;y(s,m.current)||(m.current=s,g(s)),u==="native"&&h(!1),V(!0)},commitValidation(){u==="native"&&h(!0),V(!0)}}}function x(a){return a?Array.isArray(a)?a:[a]:[]}function k(a,e){if(typeof a=="function"){let t=a(e);if(t&&typeof t!="boolean")return x(t)}return[]}function L(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:w}:null}function y(a,e){return a===e?!0:!!a&&!!e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((t,i)=>t===e.validationErrors[i])&&Object.entries(a.validationDetails).every(([t,i])=>e.validationDetails[t]===i)}function ae(...a){let e=new Set,t=!1,i={...I};for(let o of a){var n,l;for(let u of o.validationErrors)e.add(u);t||(t=o.isInvalid);for(let u in i)(n=i)[l=u]||(n[l]=o.validationDetails[u])}return i.valid=!t,{isInvalid:t,validationErrors:[...e],validationDetails:i}}function ie(a,e,t){let{validationBehavior:i,focus:n}=a;j(()=>{if(i==="native"&&(t!=null&&t.current)){let d=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(d),t.current.hasAttribute("title")||(t.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(Y(t.current))}});let l=b(()=>{e.resetValidation()}),o=b(d=>{var v;e.displayValidation.isInvalid||e.commitValidation();let c=t==null||(v=t.current)===null||v===void 0?void 0:v.form;if(!d.defaultPrevented&&t&&c&&z(c)===t.current){var f;n?n():(f=t.current)===null||f===void 0||f.focus(),T("keyboard")}d.preventDefault()}),u=b(()=>{e.commitValidation()});r.useEffect(()=>{let d=t==null?void 0:t.current;if(!d)return;let v=d.form;return d.addEventListener("invalid",o),d.addEventListener("change",u),v==null||v.addEventListener("reset",l),()=>{d.removeEventListener("invalid",o),d.removeEventListener("change",u),v==null||v.removeEventListener("reset",l)}},[t,o,u,l,i])}function q(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function Y(a){return{isInvalid:!a.validity.valid,validationDetails:q(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function z(a){for(let e=0;e<a.elements.length;e++){let t=a.elements[e];if(!t.validity.valid)return t}return null}const A=r.createContext(null);function G(a,e){let t=r.useContext(A);return t!=null&&t.isInvalid?D.createElement(H,{...a,ref:e}):null}const re=r.forwardRef(G),H=r.forwardRef((a,e)=>{let t=r.useContext(A),i=U(a),n=P({...a,defaultClassName:"react-aria-FieldError",defaultChildren:t.validationErrors.length===0?void 0:t.validationErrors.join(" "),values:t});return n.children==null?null:D.createElement(N,{slot:"errorMessage",...i,...n,ref:e})}),le=r.createContext(null);export{le as $,A as a,re as b,te as c,ee as d,ie as e,C as f,$ as g,ae as h,I as i};
