import{h as U,i as K,b as j,j as m,k as v,g as G,l as B,m as J,n as _,o as Y,p as Q,q as X}from"./useFocusRing-CPQALXIu.js";import{f as k}from"./utils-Dv9Ux5aE.js";import{r as w,R}from"./index-BbAIUH2N.js";class Z{get currentNode(){return this._currentNode}set currentNode(e){if(!K(this.root,e))throw new Error("Cannot set currentNode to a node that is not contained by the root node.");const t=[];let n=e,o=e;for(this._currentNode=e;n&&n!==this.root;)if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const a=n,i=this._doc.createTreeWalker(a,this.whatToShow,{acceptNode:this._acceptNode});t.push(i),i.currentNode=o,this._currentSetFor.add(i),n=o=a.host}else n=n.parentNode;const u=this._doc.createTreeWalker(this.root,this.whatToShow,{acceptNode:this._acceptNode});t.push(u),u.currentNode=o,this._currentSetFor.add(u),this._walkerStack=t}get doc(){return this._doc}firstChild(){let e=this.currentNode,t=this.nextNode();return K(e,t)?(t&&(this.currentNode=t),t):(this.currentNode=e,null)}lastChild(){let t=this._walkerStack[0].lastChild();return t&&(this.currentNode=t),t}nextNode(){const e=this._walkerStack[0].nextNode();if(e){if(e.shadowRoot){var t;let o;if(typeof this.filter=="function"?o=this.filter(e):!((t=this.filter)===null||t===void 0)&&t.acceptNode&&(o=this.filter.acceptNode(e)),o===NodeFilter.FILTER_ACCEPT)return this.currentNode=e,e;let u=this.nextNode();return u&&(this.currentNode=u),u}return e&&(this.currentNode=e),e}else if(this._walkerStack.length>1){this._walkerStack.shift();let n=this.nextNode();return n&&(this.currentNode=n),n}else return null}previousNode(){const e=this._walkerStack[0];if(e.currentNode===e.root){if(this._currentSetFor.has(e))if(this._currentSetFor.delete(e),this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null;return null}const t=e.previousNode();if(t){if(t.shadowRoot){var n;let u;if(typeof this.filter=="function"?u=this.filter(t):!((n=this.filter)===null||n===void 0)&&n.acceptNode&&(u=this.filter.acceptNode(t)),u===NodeFilter.FILTER_ACCEPT)return t&&(this.currentNode=t),t;let a=this.lastChild();return a&&(this.currentNode=a),a}return t&&(this.currentNode=t),t}else if(this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null}nextSibling(){return null}previousSibling(){return null}parentNode(){return null}constructor(e,t,n,o){this._walkerStack=[],this._currentSetFor=new Set,this._acceptNode=a=>{if(a.nodeType===Node.ELEMENT_NODE){const s=a.shadowRoot;if(s){const l=this._doc.createTreeWalker(s,this.whatToShow,{acceptNode:this._acceptNode});return this._walkerStack.unshift(l),NodeFilter.FILTER_ACCEPT}else{var i;if(typeof this.filter=="function")return this.filter(a);if(!((i=this.filter)===null||i===void 0)&&i.acceptNode)return this.filter.acceptNode(a);if(this.filter===null)return NodeFilter.FILTER_ACCEPT}}return NodeFilter.FILTER_SKIP},this._doc=e,this.root=t,this.filter=o??null,this.whatToShow=n??NodeFilter.SHOW_ALL,this._currentNode=t,this._walkerStack.unshift(e.createTreeWalker(t,n,this._acceptNode));const u=t.shadowRoot;if(u){const a=this._doc.createTreeWalker(u,this.whatToShow,{acceptNode:this._acceptNode});this._walkerStack.unshift(a)}}}function O(r,e,t,n){return U()?new Z(r,e,t,n):r.createTreeWalker(e,t,n)}function ee(r){const e=j(r);if(!(r instanceof e.HTMLElement)&&!(r instanceof e.SVGElement))return!1;let{display:t,visibility:n}=r.style,o=t!=="none"&&n!=="hidden"&&n!=="collapse";if(o){const{getComputedStyle:u}=r.ownerDocument.defaultView;let{display:a,visibility:i}=u(r);o=a!=="none"&&i!=="hidden"&&i!=="collapse"}return o}function te(r,e){return!r.hasAttribute("hidden")&&!r.hasAttribute("data-react-aria-prevent-focus")&&(r.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?r.hasAttribute("open"):!0)}function z(r,e){return r.nodeName!=="#comment"&&ee(r)&&te(r,e)&&(!r.parentElement||z(r.parentElement,r))}const P=R.createContext(null),M="react-aria-focus-scope-restore";let h=null;function ce(r){let{children:e,contain:t,restoreFocus:n,autoFocus:o}=r,u=w.useRef(null),a=w.useRef(null),i=w.useRef([]),{parentNode:s}=w.useContext(P)||{},l=w.useMemo(()=>new D({scopeRef:i}),[i]);k(()=>{let f=s||p.root;if(p.getTreeNode(f.scopeRef)&&h&&!F(h,f.scopeRef)){let b=p.getTreeNode(h);b&&(f=b)}f.addChild(l),p.addNode(l)},[l,s]),k(()=>{let f=p.getTreeNode(i);f&&(f.contain=!!t)},[t]),k(()=>{var f;let b=(f=u.current)===null||f===void 0?void 0:f.nextSibling,N=[],g=C=>C.stopPropagation();for(;b&&b!==a.current;)N.push(b),b.addEventListener(M,g),b=b.nextSibling;return i.current=N,()=>{for(let C of N)C.removeEventListener(M,g)}},[e]),ie(i,n,t),ne(i,t),ue(i,n,t),oe(i,o),w.useEffect(()=>{const f=m(v(i.current?i.current[0]:void 0));let b=null;if(T(f,i.current)){for(let N of p.traverse())N.scopeRef&&T(f,N.scopeRef.current)&&(b=N);b===p.getTreeNode(i)&&(h=b.scopeRef)}},[i]),k(()=>()=>{var f,b,N;let g=(N=(b=p.getTreeNode(i))===null||b===void 0||(f=b.parent)===null||f===void 0?void 0:f.scopeRef)!==null&&N!==void 0?N:null;(i===h||F(i,h))&&(!g||p.getTreeNode(g))&&(h=g),p.removeTreeNode(i)},[i]);let c=w.useMemo(()=>re(i),[]),d=w.useMemo(()=>({focusManager:c,parentNode:l}),[l,c]);return R.createElement(P.Provider,{value:d},R.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:u}),e,R.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:a}))}function re(r){return{focusNext(e={}){let t=r.current,{from:n,tabbable:o,wrap:u,accept:a}=e;var i;let s=n||m(v((i=t[0])!==null&&i!==void 0?i:void 0)),l=t[0].previousElementSibling,c=S(t),d=E(c,{tabbable:o,accept:a},t);d.currentNode=T(s,t)?s:l;let f=d.nextNode();return!f&&u&&(d.currentNode=l,f=d.nextNode()),f&&$(f,!0),f},focusPrevious(e={}){let t=r.current,{from:n,tabbable:o,wrap:u,accept:a}=e;var i;let s=n||m(v((i=t[0])!==null&&i!==void 0?i:void 0)),l=t[t.length-1].nextElementSibling,c=S(t),d=E(c,{tabbable:o,accept:a},t);d.currentNode=T(s,t)?s:l;let f=d.previousNode();return!f&&u&&(d.currentNode=l,f=d.previousNode()),f&&$(f,!0),f},focusFirst(e={}){let t=r.current,{tabbable:n,accept:o}=e,u=S(t),a=E(u,{tabbable:n,accept:o},t);a.currentNode=t[0].previousElementSibling;let i=a.nextNode();return i&&$(i,!0),i},focusLast(e={}){let t=r.current,{tabbable:n,accept:o}=e,u=S(t),a=E(u,{tabbable:n,accept:o},t);a.currentNode=t[t.length-1].nextElementSibling;let i=a.previousNode();return i&&$(i,!0),i}}}function S(r){return r[0].parentElement}function y(r){let e=p.getTreeNode(h);for(;e&&e.scopeRef!==r;){if(e.contain)return!1;e=e.parent}return!0}function ne(r,e){let t=w.useRef(void 0),n=w.useRef(void 0);k(()=>{let o=r.current;if(!e){n.current&&(cancelAnimationFrame(n.current),n.current=void 0);return}const u=v(o?o[0]:void 0);let a=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!y(r)||l.isComposing)return;let c=m(u),d=r.current;if(!d||!T(c,d))return;let f=S(d),b=E(f,{tabbable:!0},d);if(!c)return;b.currentNode=c;let N=l.shiftKey?b.previousNode():b.nextNode();N||(b.currentNode=l.shiftKey?d[d.length-1].nextElementSibling:d[0].previousElementSibling,N=l.shiftKey?b.previousNode():b.nextNode()),l.preventDefault(),N&&$(N,!0)},i=l=>{(!h||F(h,r))&&T(_(l),r.current)?(h=r,t.current=_(l)):y(r)&&!x(_(l),r)?t.current?t.current.focus():h&&h.current&&A(h.current):y(r)&&(t.current=_(l))},s=l=>{n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{let c=X(),d=(c==="virtual"||c===null)&&Y()&&Q(),f=m(u);if(!d&&f&&y(r)&&!x(f,r)){h=r;let N=_(l);if(N&&N.isConnected){var b;t.current=N,(b=t.current)===null||b===void 0||b.focus()}else h.current&&A(h.current)}})};return u.addEventListener("keydown",a,!1),u.addEventListener("focusin",i,!1),o==null||o.forEach(l=>l.addEventListener("focusin",i,!1)),o==null||o.forEach(l=>l.addEventListener("focusout",s,!1)),()=>{u.removeEventListener("keydown",a,!1),u.removeEventListener("focusin",i,!1),o==null||o.forEach(l=>l.removeEventListener("focusin",i,!1)),o==null||o.forEach(l=>l.removeEventListener("focusout",s,!1))}},[r,e]),k(()=>()=>{n.current&&cancelAnimationFrame(n.current)},[n])}function q(r){return x(r)}function T(r,e){return!r||!e?!1:e.some(t=>t.contains(r))}function x(r,e=null){if(r instanceof Element&&r.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:t}of p.traverse(p.getTreeNode(e)))if(t&&T(r,t.current))return!0;return!1}function fe(r){return x(r,h)}function F(r,e){var t;let n=(t=p.getTreeNode(e))===null||t===void 0?void 0:t.parent;for(;n;){if(n.scopeRef===r)return!0;n=n.parent}return!1}function $(r,e=!1){if(r!=null&&!e)try{G(r)}catch{}else if(r!=null)try{r.focus()}catch{}}function H(r,e=!0){let t=r[0].previousElementSibling,n=S(r),o=E(n,{tabbable:e},r);o.currentNode=t;let u=o.nextNode();return e&&!u&&(n=S(r),o=E(n,{tabbable:!1},r),o.currentNode=t,u=o.nextNode()),u}function A(r,e=!0){$(H(r,e))}function oe(r,e){const t=R.useRef(e);w.useEffect(()=>{if(t.current){h=r;const n=v(r.current?r.current[0]:void 0);!T(m(n),h.current)&&r.current&&A(r.current)}t.current=!1},[r])}function ie(r,e,t){k(()=>{if(e||t)return;let n=r.current;const o=v(n?n[0]:void 0);let u=a=>{let i=_(a);T(i,r.current)?h=r:q(i)||(h=null)};return o.addEventListener("focusin",u,!1),n==null||n.forEach(a=>a.addEventListener("focusin",u,!1)),()=>{o.removeEventListener("focusin",u,!1),n==null||n.forEach(a=>a.removeEventListener("focusin",u,!1))}},[r,e,t])}function W(r){let e=p.getTreeNode(h);for(;e&&e.scopeRef!==r;){if(e.nodeToRestore)return!1;e=e.parent}return(e==null?void 0:e.scopeRef)===r}function ue(r,e,t){const n=w.useRef(typeof document<"u"?m(v(r.current?r.current[0]:void 0)):null);k(()=>{let o=r.current;const u=v(o?o[0]:void 0);if(!e||t)return;let a=()=>{(!h||F(h,r))&&T(m(u),r.current)&&(h=r)};return u.addEventListener("focusin",a,!1),o==null||o.forEach(i=>i.addEventListener("focusin",a,!1)),()=>{u.removeEventListener("focusin",a,!1),o==null||o.forEach(i=>i.removeEventListener("focusin",a,!1))}},[r,t]),k(()=>{const o=v(r.current?r.current[0]:void 0);if(!e)return;let u=a=>{if(a.key!=="Tab"||a.altKey||a.ctrlKey||a.metaKey||!y(r)||a.isComposing)return;let i=o.activeElement;if(!x(i,r)||!W(r))return;let s=p.getTreeNode(r);if(!s)return;let l=s.nodeToRestore,c=E(o.body,{tabbable:!0});c.currentNode=i;let d=a.shiftKey?c.previousNode():c.nextNode();if((!l||!l.isConnected||l===o.body)&&(l=void 0,s.nodeToRestore=void 0),(!d||!x(d,r))&&l){c.currentNode=l;do d=a.shiftKey?c.previousNode():c.nextNode();while(x(d,r));a.preventDefault(),a.stopPropagation(),d?$(d,!0):q(l)?$(l,!0):i.blur()}};return t||o.addEventListener("keydown",u,!0),()=>{t||o.removeEventListener("keydown",u,!0)}},[r,e,t]),k(()=>{const o=v(r.current?r.current[0]:void 0);if(!e)return;let u=p.getTreeNode(r);if(u){var a;return u.nodeToRestore=(a=n.current)!==null&&a!==void 0?a:void 0,()=>{let i=p.getTreeNode(r);if(!i)return;let s=i.nodeToRestore,l=m(o);if(e&&s&&(l&&x(l,r)||l===o.body&&W(r))){let c=p.clone();requestAnimationFrame(()=>{if(o.activeElement===o.body){let d=c.getTreeNode(r);for(;d;){if(d.nodeToRestore&&d.nodeToRestore.isConnected){V(d.nodeToRestore);return}d=d.parent}for(d=c.getTreeNode(r);d;){if(d.scopeRef&&d.scopeRef.current&&p.getTreeNode(d.scopeRef)){let f=H(d.scopeRef.current,!0);V(f);return}d=d.parent}}})}}}},[r,e])}function V(r){r.dispatchEvent(new CustomEvent(M,{bubbles:!0,cancelable:!0}))&&$(r)}function E(r,e,t){let n=e!=null&&e.tabbable?B:J,o=(r==null?void 0:r.nodeType)===Node.ELEMENT_NODE?r:null,u=v(o),a=O(u,r||u,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var s;return!(e==null||(s=e.from)===null||s===void 0)&&s.contains(i)?NodeFilter.FILTER_REJECT:n(i)&&z(i)&&(!t||T(i,t))&&(!(e!=null&&e.accept)||e.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e!=null&&e.from&&(a.currentNode=e.from),a}function se(r,e={}){return{focusNext(t={}){let n=r.current;if(!n)return null;let{from:o,tabbable:u=e.tabbable,wrap:a=e.wrap,accept:i=e.accept}=t,s=o||m(v(n)),l=E(n,{tabbable:u,accept:i});n.contains(s)&&(l.currentNode=s);let c=l.nextNode();return!c&&a&&(l.currentNode=n,c=l.nextNode()),c&&$(c,!0),c},focusPrevious(t=e){let n=r.current;if(!n)return null;let{from:o,tabbable:u=e.tabbable,wrap:a=e.wrap,accept:i=e.accept}=t,s=o||m(v(n)),l=E(n,{tabbable:u,accept:i});if(n.contains(s))l.currentNode=s;else{let d=L(l);return d&&$(d,!0),d??null}let c=l.previousNode();if(!c&&a){l.currentNode=n;let d=L(l);if(!d)return null;c=d}return c&&$(c,!0),c??null},focusFirst(t=e){let n=r.current;if(!n)return null;let{tabbable:o=e.tabbable,accept:u=e.accept}=t,i=E(n,{tabbable:o,accept:u}).nextNode();return i&&$(i,!0),i},focusLast(t=e){let n=r.current;if(!n)return null;let{tabbable:o=e.tabbable,accept:u=e.accept}=t,a=E(n,{tabbable:o,accept:u}),i=L(a);return i&&$(i,!0),i??null}}}function L(r){let e,t;do t=r.lastChild(),t&&(e=t);while(t);return e}class I{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,t,n){let o=this.fastMap.get(t??null);if(!o)return;let u=new D({scopeRef:e});o.addChild(u),u.parent=o,this.fastMap.set(e,u),n&&(u.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let t=this.fastMap.get(e);if(!t)return;let n=t.parent;for(let u of this.traverse())u!==t&&t.nodeToRestore&&u.nodeToRestore&&t.scopeRef&&t.scopeRef.current&&T(u.nodeToRestore,t.scopeRef.current)&&(u.nodeToRestore=t.nodeToRestore);let o=t.children;n&&(n.removeChild(t),o.size>0&&o.forEach(u=>n&&n.addChild(u))),this.fastMap.delete(t.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let t of e.children)yield*this.traverse(t)}clone(){var e;let t=new I;var n;for(let o of this.traverse())t.addTreeNode(o.scopeRef,(n=(e=o.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&n!==void 0?n:null,o.nodeToRestore);return t}constructor(){this.fastMap=new Map,this.root=new D({scopeRef:null}),this.fastMap.set(null,this.root)}}class D{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let p=new I;export{E as $,ce as a,se as b,fe as c};
