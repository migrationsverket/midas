import{$ as x,a as v,b as m}from"./SelectionManager-CH_UAKbc.js";import{r as o}from"./index-BbAIUH2N.js";class k{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(n){let e=this.keyMap.get(n);var l;return e&&(l=e.prevKey)!==null&&l!==void 0?l:null}getKeyAfter(n){let e=this.keyMap.get(n);var l;return e&&(l=e.nextKey)!==null&&l!==void 0?l:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(n){var e;return(e=this.keyMap.get(n))!==null&&e!==void 0?e:null}at(n){const e=[...this.getKeys()];return this.getItem(e[n])}getChildren(n){let e=this.keyMap.get(n);return(e==null?void 0:e.childNodes)||[]}constructor(n){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=n;let e=u=>{if(this.keyMap.set(u.key,u),u.childNodes&&u.type==="section")for(let d of u.childNodes)e(d)};for(let u of n)e(u);let l=null,y=0;for(let[u,d]of this.keyMap)l?(l.nextKey=u,d.prevKey=l.key):(this.firstKey=u,d.prevKey=void 0),d.type==="item"&&(d.index=y++),l=d,l.nextKey=void 0;var s;this.lastKey=(s=l==null?void 0:l.key)!==null&&s!==void 0?s:null}}function C(t){let{filter:n,layoutDelegate:e}=t,l=x(t),y=o.useMemo(()=>t.disabledKeys?new Set(t.disabledKeys):new Set,[t.disabledKeys]),s=o.useCallback(h=>n?new k(n(h)):new k(h),[n]),u=o.useMemo(()=>({suppressTextValueWarning:t.suppressTextValueWarning}),[t.suppressTextValueWarning]),d=v(t,s,u),K=o.useMemo(()=>new m(d,l,{layoutDelegate:e}),[d,l,e]);return M(d,K),{collection:d,disabledKeys:y,selectionManager:K}}function D(t,n){let e=o.useMemo(()=>n?t.collection.UNSTABLE_filter(n):t.collection,[t.collection,n]),l=t.selectionManager.withCollection(e);return M(e,l),{collection:e,selectionManager:l,disabledKeys:t.disabledKeys}}function M(t,n){const e=o.useRef(null);o.useEffect(()=>{if(n.focusedKey!=null&&!t.getItem(n.focusedKey)&&e.current){const i=e.current.getItem(n.focusedKey),b=[...e.current.getKeys()].map(c=>{const r=e.current.getItem(c);return(r==null?void 0:r.type)==="item"?r:null}).filter(c=>c!==null),f=[...t.getKeys()].map(c=>{const r=t.getItem(c);return(r==null?void 0:r.type)==="item"?r:null}).filter(c=>c!==null);var l,y;const p=((l=b==null?void 0:b.length)!==null&&l!==void 0?l:0)-((y=f==null?void 0:f.length)!==null&&y!==void 0?y:0);var s,u,d;let a=Math.min(p>1?Math.max(((s=i==null?void 0:i.index)!==null&&s!==void 0?s:0)-p+1,0):(u=i==null?void 0:i.index)!==null&&u!==void 0?u:0,((d=f==null?void 0:f.length)!==null&&d!==void 0?d:0)-1),g=null,$=!1;for(;a>=0;){if(!n.isDisabled(f[a].key)){g=f[a];break}if(a<f.length-1&&!$)a++;else{$=!0;var K,h;a>((K=i==null?void 0:i.index)!==null&&K!==void 0?K:0)&&(a=(h=i==null?void 0:i.index)!==null&&h!==void 0?h:0),a--}}n.setFocusedKey(g?g.key:null)}e.current=t},[t,n])}export{C as $,D as a,k as b};
