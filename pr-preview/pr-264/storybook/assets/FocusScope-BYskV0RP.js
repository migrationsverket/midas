import{h as q,j as g,q as m,r as U,s as H,t as W,u as G}from"./useFocusable-eIx-4jzq.js";import{r as N,R as L}from"./index-BbAIUH2N.js";function J(e){const t=q(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:n,visibility:a}=e.style,r=n!=="none"&&a!=="hidden"&&a!=="collapse";if(r){const{getComputedStyle:u}=e.ownerDocument.defaultView;let{display:d,visibility:o}=u(e);r=d!=="none"&&o!=="hidden"&&o!=="collapse"}return r}function Y(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function V(e,t){return e.nodeName!=="#comment"&&J(e)&&Y(e,t)&&(!e.parentElement||V(e.parentElement,e))}const D=L.createContext(null),C="react-aria-focus-scope-restore";let f=null;function ae(e){let{children:t,contain:n,restoreFocus:a,autoFocus:r}=e,u=N.useRef(null),d=N.useRef(null),o=N.useRef([]),{parentNode:p}=N.useContext(D)||{},l=N.useMemo(()=>new M({scopeRef:o}),[o]);g(()=>{let s=p||v.root;if(v.getTreeNode(s.scopeRef)&&f&&!R(f,s.scopeRef)){let b=v.getTreeNode(f);b&&(s=b)}s.addChild(l),v.addNode(l)},[l,p]),g(()=>{let s=v.getTreeNode(o);s&&(s.contain=!!n)},[n]),g(()=>{var s;let b=(s=u.current)===null||s===void 0?void 0:s.nextSibling,$=[],y=F=>F.stopPropagation();for(;b&&b!==d.current;)$.push(b),b.addEventListener(C,y),b=b.nextSibling;return o.current=$,()=>{for(let F of $)F.removeEventListener(C,y)}},[t]),ee(o,a,n),Z(o,n),te(o,a,n),O(o,r),N.useEffect(()=>{const s=m(o.current?o.current[0]:void 0).activeElement;let b=null;if(T(s,o.current)){for(let $ of v.traverse())$.scopeRef&&T(s,$.scopeRef.current)&&(b=$);b===v.getTreeNode(o)&&(f=b.scopeRef)}},[o]),g(()=>()=>{var s,b,$;let y=($=(b=v.getTreeNode(o))===null||b===void 0||(s=b.parent)===null||s===void 0?void 0:s.scopeRef)!==null&&$!==void 0?$:null;(o===f||R(o,f))&&(!y||v.getTreeNode(y))&&(f=y),v.removeTreeNode(o)},[o]);let i=N.useMemo(()=>Q(o),[]),c=N.useMemo(()=>({focusManager:i,parentNode:l}),[l,i]);return L.createElement(D.Provider,{value:c},L.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:u}),t,L.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:d}))}function Q(e){return{focusNext(t={}){let n=e.current,{from:a,tabbable:r,wrap:u,accept:d}=t,o=a||m(n[0]).activeElement,p=n[0].previousElementSibling,l=x(n),i=h(l,{tabbable:r,accept:d},n);i.currentNode=T(o,n)?o:p;let c=i.nextNode();return!c&&u&&(i.currentNode=p,c=i.nextNode()),c&&E(c,!0),c},focusPrevious(t={}){let n=e.current,{from:a,tabbable:r,wrap:u,accept:d}=t,o=a||m(n[0]).activeElement,p=n[n.length-1].nextElementSibling,l=x(n),i=h(l,{tabbable:r,accept:d},n);i.currentNode=T(o,n)?o:p;let c=i.previousNode();return!c&&u&&(i.currentNode=p,c=i.previousNode()),c&&E(c,!0),c},focusFirst(t={}){let n=e.current,{tabbable:a,accept:r}=t,u=x(n),d=h(u,{tabbable:a,accept:r},n);d.currentNode=n[0].previousElementSibling;let o=d.nextNode();return o&&E(o,!0),o},focusLast(t={}){let n=e.current,{tabbable:a,accept:r}=t,u=x(n),d=h(u,{tabbable:a,accept:r},n);d.currentNode=n[n.length-1].nextElementSibling;let o=d.previousNode();return o&&E(o,!0),o}}}const A=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable^="false"])'],j=A.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";A.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const X=A.join(':not([hidden]):not([tabindex="-1"]),');function oe(e){return e.matches(j)}function x(e){return e[0].parentElement}function S(e){let t=v.getTreeNode(f);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function Z(e,t){let n=N.useRef(void 0),a=N.useRef(void 0);g(()=>{let r=e.current;if(!t){a.current&&(cancelAnimationFrame(a.current),a.current=void 0);return}const u=m(r?r[0]:void 0);let d=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!S(e)||l.isComposing)return;let i=u.activeElement,c=e.current;if(!c||!T(i,c))return;let s=x(c),b=h(s,{tabbable:!0},c);if(!i)return;b.currentNode=i;let $=l.shiftKey?b.previousNode():b.nextNode();$||(b.currentNode=l.shiftKey?c[c.length-1].nextElementSibling:c[0].previousElementSibling,$=l.shiftKey?b.previousNode():b.nextNode()),l.preventDefault(),$&&E($,!0)},o=l=>{(!f||R(f,e))&&T(l.target,e.current)?(f=e,n.current=l.target):S(e)&&!w(l.target,e)?n.current?n.current.focus():f&&f.current&&k(f.current):S(e)&&(n.current=l.target)},p=l=>{a.current&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{let i=G();if(!((i==="virtual"||i===null)&&H()&&W())&&u.activeElement&&S(e)&&!w(u.activeElement,e))if(f=e,u.body.contains(l.target)){var s;n.current=l.target,(s=n.current)===null||s===void 0||s.focus()}else f.current&&k(f.current)})};return u.addEventListener("keydown",d,!1),u.addEventListener("focusin",o,!1),r==null||r.forEach(l=>l.addEventListener("focusin",o,!1)),r==null||r.forEach(l=>l.addEventListener("focusout",p,!1)),()=>{u.removeEventListener("keydown",d,!1),u.removeEventListener("focusin",o,!1),r==null||r.forEach(l=>l.removeEventListener("focusin",o,!1)),r==null||r.forEach(l=>l.removeEventListener("focusout",p,!1))}},[e,t]),g(()=>()=>{a.current&&cancelAnimationFrame(a.current)},[a])}function B(e){return w(e)}function T(e,t){return!e||!t?!1:t.some(n=>n.contains(e))}function w(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of v.traverse(v.getTreeNode(t)))if(n&&T(e,n.current))return!0;return!1}function ue(e){return w(e,f)}function R(e,t){var n;let a=(n=v.getTreeNode(t))===null||n===void 0?void 0:n.parent;for(;a;){if(a.scopeRef===e)return!0;a=a.parent}return!1}function E(e,t=!1){if(e!=null&&!t)try{U(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function z(e,t=!0){let n=e[0].previousElementSibling,a=x(e),r=h(a,{tabbable:t},e);r.currentNode=n;let u=r.nextNode();return t&&!u&&(a=x(e),r=h(a,{tabbable:!1},e),r.currentNode=n,u=r.nextNode()),u}function k(e,t=!0){E(z(e,t))}function O(e,t){const n=L.useRef(t);N.useEffect(()=>{if(n.current){f=e;const a=m(e.current?e.current[0]:void 0);!T(a.activeElement,f.current)&&e.current&&k(e.current)}n.current=!1},[e])}function ee(e,t,n){g(()=>{if(t||n)return;let a=e.current;const r=m(a?a[0]:void 0);let u=d=>{let o=d.target;T(o,e.current)?f=e:B(o)||(f=null)};return r.addEventListener("focusin",u,!1),a==null||a.forEach(d=>d.addEventListener("focusin",u,!1)),()=>{r.removeEventListener("focusin",u,!1),a==null||a.forEach(d=>d.removeEventListener("focusin",u,!1))}},[e,t,n])}function I(e){let t=v.getTreeNode(f);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function te(e,t,n){const a=N.useRef(typeof document<"u"?m(e.current?e.current[0]:void 0).activeElement:null);g(()=>{let r=e.current;const u=m(r?r[0]:void 0);if(!t||n)return;let d=()=>{(!f||R(f,e))&&T(u.activeElement,e.current)&&(f=e)};return u.addEventListener("focusin",d,!1),r==null||r.forEach(o=>o.addEventListener("focusin",d,!1)),()=>{u.removeEventListener("focusin",d,!1),r==null||r.forEach(o=>o.removeEventListener("focusin",d,!1))}},[e,n]),g(()=>{const r=m(e.current?e.current[0]:void 0);if(!t)return;let u=d=>{if(d.key!=="Tab"||d.altKey||d.ctrlKey||d.metaKey||!S(e)||d.isComposing)return;let o=r.activeElement;if(!w(o,e)||!I(e))return;let p=v.getTreeNode(e);if(!p)return;let l=p.nodeToRestore,i=h(r.body,{tabbable:!0});i.currentNode=o;let c=d.shiftKey?i.previousNode():i.nextNode();if((!l||!r.body.contains(l)||l===r.body)&&(l=void 0,p.nodeToRestore=void 0),(!c||!w(c,e))&&l){i.currentNode=l;do c=d.shiftKey?i.previousNode():i.nextNode();while(w(c,e));d.preventDefault(),d.stopPropagation(),c?E(c,!0):B(l)?E(l,!0):o.blur()}};return n||r.addEventListener("keydown",u,!0),()=>{n||r.removeEventListener("keydown",u,!0)}},[e,t,n]),g(()=>{const r=m(e.current?e.current[0]:void 0);if(!t)return;let u=v.getTreeNode(e);if(u){var d;return u.nodeToRestore=(d=a.current)!==null&&d!==void 0?d:void 0,()=>{let o=v.getTreeNode(e);if(!o)return;let p=o.nodeToRestore;if(t&&p&&(r.activeElement&&w(r.activeElement,e)||r.activeElement===r.body&&I(e))){let l=v.clone();requestAnimationFrame(()=>{if(r.activeElement===r.body){let i=l.getTreeNode(e);for(;i;){if(i.nodeToRestore&&i.nodeToRestore.isConnected){P(i.nodeToRestore);return}i=i.parent}for(i=l.getTreeNode(e);i;){if(i.scopeRef&&i.scopeRef.current&&v.getTreeNode(i.scopeRef)){let c=z(i.scopeRef.current,!0);P(c);return}i=i.parent}}})}}}},[e,t])}function P(e){e.dispatchEvent(new CustomEvent(C,{bubbles:!0,cancelable:!0}))&&E(e)}function h(e,t,n){let a=t!=null&&t.tabbable?X:j,r=m(e).createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(u){var d;return!(t==null||(d=t.from)===null||d===void 0)&&d.contains(u)?NodeFilter.FILTER_REJECT:u.matches(a)&&V(u)&&(!n||T(u,n))&&(!(t!=null&&t.accept)||t.accept(u))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(r.currentNode=t.from),r}function le(e,t={}){return{focusNext(n={}){let a=e.current;if(!a)return null;let{from:r,tabbable:u=t.tabbable,wrap:d=t.wrap,accept:o=t.accept}=n,p=r||m(a).activeElement,l=h(a,{tabbable:u,accept:o});a.contains(p)&&(l.currentNode=p);let i=l.nextNode();return!i&&d&&(l.currentNode=a,i=l.nextNode()),i&&E(i,!0),i},focusPrevious(n=t){let a=e.current;if(!a)return null;let{from:r,tabbable:u=t.tabbable,wrap:d=t.wrap,accept:o=t.accept}=n,p=r||m(a).activeElement,l=h(a,{tabbable:u,accept:o});if(a.contains(p))l.currentNode=p;else{let c=_(l);return c&&E(c,!0),c??null}let i=l.previousNode();if(!i&&d){l.currentNode=a;let c=_(l);if(!c)return null;i=c}return i&&E(i,!0),i??null},focusFirst(n=t){let a=e.current;if(!a)return null;let{tabbable:r=t.tabbable,accept:u=t.accept}=n,o=h(a,{tabbable:r,accept:u}).nextNode();return o&&E(o,!0),o},focusLast(n=t){let a=e.current;if(!a)return null;let{tabbable:r=t.tabbable,accept:u=t.accept}=n,d=h(a,{tabbable:r,accept:u}),o=_(d);return o&&E(o,!0),o??null}}}function _(e){let t,n;do n=e.lastChild(),n&&(t=n);while(n);return t}class K{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,n,a){let r=this.fastMap.get(n??null);if(!r)return;let u=new M({scopeRef:t});r.addChild(u),u.parent=r,this.fastMap.set(t,u),a&&(u.nodeToRestore=a)}addNode(t){this.fastMap.set(t.scopeRef,t)}removeTreeNode(t){if(t===null)return;let n=this.fastMap.get(t);if(!n)return;let a=n.parent;for(let u of this.traverse())u!==n&&n.nodeToRestore&&u.nodeToRestore&&n.scopeRef&&n.scopeRef.current&&T(u.nodeToRestore,n.scopeRef.current)&&(u.nodeToRestore=n.nodeToRestore);let r=n.children;a&&(a.removeChild(n),r.size>0&&r.forEach(u=>a&&a.addChild(u))),this.fastMap.delete(n.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.size>0)for(let n of t.children)yield*this.traverse(n)}clone(){var t;let n=new K;var a;for(let r of this.traverse())n.addTreeNode(r.scopeRef,(a=(t=r.parent)===null||t===void 0?void 0:t.scopeRef)!==null&&a!==void 0?a:null,r.nodeToRestore);return n}constructor(){this.fastMap=new Map,this.root=new M({scopeRef:null}),this.fastMap.set(null,this.root)}}class M{addChild(t){this.children.add(t),t.parent=this}removeChild(t){this.children.delete(t),t.parent=void 0}constructor(t){this.children=new Set,this.contain=!1,this.scopeRef=t.scopeRef}}let v=new K;export{h as $,ae as a,ue as b,oe as c,le as d};
