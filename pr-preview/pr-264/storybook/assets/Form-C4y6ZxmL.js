import{i as E,g as j,F as T,o as U,c as Q,$ as _}from"./useFocusable-Ca924fmk.js";import{r as n,R as m}from"./index-BbAIUH2N.js";import{$ as k}from"./Text-BkfI_mlu.js";function ae(t,e,a){let i=n.useRef(e),l=E(()=>{a&&a(i.current)});n.useEffect(()=>{var r;let d=t==null||(r=t.current)===null||r===void 0?void 0:r.form;return d==null||d.addEventListener("reset",l),()=>{d==null||d.removeEventListener("reset",l)}},[t,l])}const M={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},R={...M,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:M,validationErrors:[]},A=n.createContext({}),L="__formValidationState"+Date.now();function te(t){if(t[L]){let{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:l,commitValidation:r}=t[L];return{realtimeValidation:e,displayValidation:a,updateValidation:i,resetValidation:l,commitValidation:r}}return q(t)}function q(t){let{isInvalid:e,validationState:a,name:i,value:l,builtinValidation:r,validate:d,validationBehavior:o="aria"}=t;a&&(e||(e=a==="invalid"));let s=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:R}:null,f=n.useMemo(()=>{if(!d||l==null)return null;let u=Y(d,l);return D(u)},[d,l]);r!=null&&r.validationDetails.valid&&(r=void 0);let c=n.useContext(A),v=n.useMemo(()=>i?Array.isArray(i)?i.flatMap(u=>I(c[u])):I(c[i]):[],[c,i]),[B,P]=n.useState(c),[S,V]=n.useState(!1);c!==B&&(P(c),V(!1));let p=n.useMemo(()=>D(S?[]:v),[S,v]),C=n.useRef($),[h,g]=n.useState($),b=n.useRef($),N=()=>{if(!O)return;y(!1);let u=f||r||C.current;x(u,b.current)||(b.current=u,g(u))},[O,y]=n.useState(!1);return n.useEffect(N),{realtimeValidation:s||p||f||r||$,displayValidation:o==="native"?s||p||h:s||p||f||r||h,updateValidation(u){o==="aria"&&!x(h,u)?g(u):C.current=u},resetValidation(){let u=$;x(u,b.current)||(b.current=u,g(u)),o==="native"&&y(!1),V(!0)},commitValidation(){o==="native"&&y(!0),V(!0)}}}function I(t){return t?Array.isArray(t)?t:[t]:[]}function Y(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return I(a)}return[]}function D(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:R}:null}function x(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,i)=>a===e.validationErrors[i])&&Object.entries(t.validationDetails).every(([a,i])=>e.validationDetails[a]===i)}function ie(...t){let e=new Set,a=!1,i={...M};for(let d of t){var l,r;for(let o of d.validationErrors)e.add(o);a||(a=d.isInvalid);for(let o in i)(l=i)[r=o]||(l[r]=d.validationDetails[o])}return i.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:i}}function re(t,e,a){let{validationBehavior:i,focus:l}=t;j(()=>{if(i==="native"&&(a!=null&&a.current)&&!a.current.disabled){let s=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(s),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(G(a.current))}});let r=E(()=>{e.resetValidation()}),d=E(s=>{var f;e.displayValidation.isInvalid||e.commitValidation();let c=a==null||(f=a.current)===null||f===void 0?void 0:f.form;if(!s.defaultPrevented&&a&&c&&H(c)===a.current){var v;l?l():(v=a.current)===null||v===void 0||v.focus(),T("keyboard")}s.preventDefault()}),o=E(()=>{e.commitValidation()});n.useEffect(()=>{let s=a==null?void 0:a.current;if(!s)return;let f=s.form;return s.addEventListener("invalid",d),s.addEventListener("change",o),f==null||f.addEventListener("reset",r),()=>{s.removeEventListener("invalid",d),s.removeEventListener("change",o),f==null||f.removeEventListener("reset",r)}},[a,d,o,r,i])}function z(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function G(t){return{isInvalid:!t.validity.valid,validationDetails:z(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function H(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}const F=n.createContext(null),ne=n.forwardRef(function(e,a){let i=n.useContext(F);return i!=null&&i.isInvalid?m.createElement(J,{...e,ref:a}):null}),J=n.forwardRef((t,e)=>{let a=n.useContext(F),i=U(t),l=Q({...t,defaultClassName:"react-aria-FieldError",defaultChildren:a.validationErrors.length===0?void 0:a.validationErrors.join(" "),values:a});return l.children==null?null:m.createElement(k,{slot:"errorMessage",...i,...l,ref:e})}),w=n.createContext(null),le=n.forwardRef(function(e,a){[e,a]=_(e,a,w);let{validationErrors:i,validationBehavior:l="native",children:r,className:d,...o}=e;return m.createElement("form",{noValidate:l!=="native",...o,ref:a,className:d||"react-aria-Form"},m.createElement(w.Provider,{value:{...e,validationBehavior:l}},m.createElement(A.Provider,{value:i??{}},r)))});export{le as $,ne as a,te as b,ae as c,re as d,w as e,F as f,L as g,$ as h,ie as i,M as j};
