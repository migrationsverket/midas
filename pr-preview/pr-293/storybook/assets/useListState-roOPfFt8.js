import{$ as C,a as T,b as V}from"./SelectionManager-C4ptO5S1.js";import{r as c}from"./index-BbAIUH2N.js";class D{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(l){let n=this.keyMap.get(l);var e;return n&&(e=n.prevKey)!==null&&e!==void 0?e:null}getKeyAfter(l){let n=this.keyMap.get(l);var e;return n&&(e=n.nextKey)!==null&&e!==void 0?e:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(l){var n;return(n=this.keyMap.get(l))!==null&&n!==void 0?n:null}at(l){const n=[...this.getKeys()];return this.getItem(n[l])}getChildren(l){let n=this.keyMap.get(l);return(n==null?void 0:n.childNodes)||[]}constructor(l){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=l;let n=u=>{if(this.keyMap.set(u.key,u),u.childNodes&&u.type==="section")for(let t of u.childNodes)n(t)};for(let u of l)n(u);let e=null,g=0;for(let[u,t]of this.keyMap)e?(e.nextKey=u,t.prevKey=e.key):(this.firstKey=u,t.prevKey=void 0),t.type==="item"&&(t.index=g++),e=t,e.nextKey=void 0;var o;this.lastKey=(o=e==null?void 0:e.key)!==null&&o!==void 0?o:null}}function E(d){let{filter:l,layoutDelegate:n}=d,e=C(d),g=c.useMemo(()=>d.disabledKeys?new Set(d.disabledKeys):new Set,[d.disabledKeys]),o=c.useCallback(y=>l?new D(l(y)):new D(y),[l]),u=c.useMemo(()=>({suppressTextValueWarning:d.suppressTextValueWarning}),[d.suppressTextValueWarning]),t=T(d,o,u),h=c.useMemo(()=>new V(t,e,{layoutDelegate:n}),[t,e,n]);const K=c.useRef(null);return c.useEffect(()=>{if(e.focusedKey!=null&&!t.getItem(e.focusedKey)&&K.current){const i=K.current.getItem(e.focusedKey),v=[...K.current.getKeys()].map(a=>{const f=K.current.getItem(a);return(f==null?void 0:f.type)==="item"?f:null}).filter(a=>a!==null),s=[...t.getKeys()].map(a=>{const f=t.getItem(a);return(f==null?void 0:f.type)==="item"?f:null}).filter(a=>a!==null);var y,p;const w=((y=v==null?void 0:v.length)!==null&&y!==void 0?y:0)-((p=s==null?void 0:s.length)!==null&&p!==void 0?p:0);var k,b,M;let r=Math.min(w>1?Math.max(((k=i==null?void 0:i.index)!==null&&k!==void 0?k:0)-w+1,0):(b=i==null?void 0:i.index)!==null&&b!==void 0?b:0,((M=s==null?void 0:s.length)!==null&&M!==void 0?M:0)-1),m=null,S=!1;for(;r>=0;){if(!h.isDisabled(s[r].key)){m=s[r];break}if(r<s.length-1&&!S)r++;else{S=!0;var $,x;r>(($=i==null?void 0:i.index)!==null&&$!==void 0?$:0)&&(r=(x=i==null?void 0:i.index)!==null&&x!==void 0?x:0),r--}}e.setFocusedKey(m?m.key:null)}K.current=t},[t,h,e,e.focusedKey]),{collection:t,disabledKeys:g,selectionManager:h}}export{E as $,D as a};
