import{$ as h}from"./scrollIntoView-CFanVOW_.js";import{r as s,R as u}from"./index-ClcD9ViR.js";class c{getItemRect(e){let t=this.ref.current;if(!t)return null;let i=e!=null?t.querySelector(`[data-key="${CSS.escape(e.toString())}"]`):null;if(!i)return null;let l=t.getBoundingClientRect(),n=i.getBoundingClientRect();return{x:n.left-l.left+t.scrollLeft,y:n.top-l.top+t.scrollTop,width:n.width,height:n.height}}getContentSize(){let e=this.ref.current;var t,i;return{width:(t=e==null?void 0:e.scrollWidth)!==null&&t!==void 0?t:0,height:(i=e==null?void 0:e.scrollHeight)!==null&&i!==void 0?i:0}}getVisibleRect(){let e=this.ref.current;var t,i,l,n;return{x:(t=e==null?void 0:e.scrollLeft)!==null&&t!==void 0?t:0,y:(i=e==null?void 0:e.scrollTop)!==null&&i!==void 0?i:0,width:(l=e==null?void 0:e.offsetWidth)!==null&&l!==void 0?l:0,height:(n=e==null?void 0:e.offsetHeight)!==null&&n!==void 0?n:0}}constructor(e){this.ref=e}}class K{isDisabled(e){var t;return this.disabledBehavior==="all"&&(((t=e.props)===null||t===void 0?void 0:t.isDisabled)||this.disabledKeys.has(e.key))}findNextNonDisabled(e,t){let i=e;for(;i!=null;){let l=this.collection.getItem(i);if((l==null?void 0:l.type)==="item"&&!this.isDisabled(l))return i;i=t(i)}return null}getNextKey(e){let t=e;return t=this.collection.getKeyAfter(t),this.findNextNonDisabled(t,i=>this.collection.getKeyAfter(i))}getPreviousKey(e){let t=e;return t=this.collection.getKeyBefore(t),this.findNextNonDisabled(t,i=>this.collection.getKeyBefore(i))}findKey(e,t,i){let l=e,n=this.layoutDelegate.getItemRect(l);if(!n||l==null)return null;let o=n;do{if(l=t(l),l==null)break;n=this.layoutDelegate.getItemRect(l)}while(n&&i(o,n)&&l!=null);return l}isSameRow(e,t){return e.y===t.y||e.x!==t.x}isSameColumn(e,t){return e.x===t.x||e.y!==t.y}getKeyBelow(e){return this.layout==="grid"&&this.orientation==="vertical"?this.findKey(e,t=>this.getNextKey(t),this.isSameRow):this.getNextKey(e)}getKeyAbove(e){return this.layout==="grid"&&this.orientation==="vertical"?this.findKey(e,t=>this.getPreviousKey(t),this.isSameRow):this.getPreviousKey(e)}getNextColumn(e,t){return t?this.getPreviousKey(e):this.getNextKey(e)}getKeyRightOf(e){let t=this.direction==="ltr"?"getKeyRightOf":"getKeyLeftOf";return this.layoutDelegate[t]?(e=this.layoutDelegate[t](e),this.findNextNonDisabled(e,i=>this.layoutDelegate[t](i))):this.layout==="grid"?this.orientation==="vertical"?this.getNextColumn(e,this.direction==="rtl"):this.findKey(e,i=>this.getNextColumn(i,this.direction==="rtl"),this.isSameColumn):this.orientation==="horizontal"?this.getNextColumn(e,this.direction==="rtl"):null}getKeyLeftOf(e){let t=this.direction==="ltr"?"getKeyLeftOf":"getKeyRightOf";return this.layoutDelegate[t]?(e=this.layoutDelegate[t](e),this.findNextNonDisabled(e,i=>this.layoutDelegate[t](i))):this.layout==="grid"?this.orientation==="vertical"?this.getNextColumn(e,this.direction==="ltr"):this.findKey(e,i=>this.getNextColumn(i,this.direction==="ltr"),this.isSameColumn):this.orientation==="horizontal"?this.getNextColumn(e,this.direction==="ltr"):null}getFirstKey(){let e=this.collection.getFirstKey();return this.findNextNonDisabled(e,t=>this.collection.getKeyAfter(t))}getLastKey(){let e=this.collection.getLastKey();return this.findNextNonDisabled(e,t=>this.collection.getKeyBefore(t))}getKeyPageAbove(e){let t=this.ref.current,i=this.layoutDelegate.getItemRect(e);if(!i)return null;if(t&&!h(t))return this.getFirstKey();let l=e;if(this.orientation==="horizontal"){let n=Math.max(0,i.x+i.width-this.layoutDelegate.getVisibleRect().width);for(;i&&i.x>n&&l!=null;)l=this.getKeyAbove(l),i=l==null?null:this.layoutDelegate.getItemRect(l)}else{let n=Math.max(0,i.y+i.height-this.layoutDelegate.getVisibleRect().height);for(;i&&i.y>n&&l!=null;)l=this.getKeyAbove(l),i=l==null?null:this.layoutDelegate.getItemRect(l)}return l??this.getFirstKey()}getKeyPageBelow(e){let t=this.ref.current,i=this.layoutDelegate.getItemRect(e);if(!i)return null;if(t&&!h(t))return this.getLastKey();let l=e;if(this.orientation==="horizontal"){let n=Math.min(this.layoutDelegate.getContentSize().width,i.y-i.width+this.layoutDelegate.getVisibleRect().width);for(;i&&i.x<n&&l!=null;)l=this.getKeyBelow(l),i=l==null?null:this.layoutDelegate.getItemRect(l)}else{let n=Math.min(this.layoutDelegate.getContentSize().height,i.y-i.height+this.layoutDelegate.getVisibleRect().height);for(;i&&i.y<n&&l!=null;)l=this.getKeyBelow(l),i=l==null?null:this.layoutDelegate.getItemRect(l)}return l??this.getLastKey()}getKeyForSearch(e,t){if(!this.collator)return null;let i=this.collection,l=t||this.getFirstKey();for(;l!=null;){let n=i.getItem(l);if(!n)return null;let o=n.textValue.slice(0,e.length);if(n.textValue&&this.collator.compare(o,e)===0)return l;l=this.getNextKey(l)}return null}constructor(...e){if(e.length===1){let t=e[0];this.collection=t.collection,this.ref=t.ref,this.collator=t.collator,this.disabledKeys=t.disabledKeys||new Set,this.disabledBehavior=t.disabledBehavior||"all",this.orientation=t.orientation||"vertical",this.direction=t.direction,this.layout=t.layout||"stack",this.layoutDelegate=t.layoutDelegate||new c(t.ref)}else this.collection=e[0],this.disabledKeys=e[1],this.ref=e[2],this.collator=e[3],this.layout="stack",this.orientation="vertical",this.disabledBehavior="all",this.layoutDelegate=new c(this.ref);this.layout==="stack"&&this.orientation==="vertical"&&(this.getKeyLeftOf=void 0,this.getKeyRightOf=void 0)}}const m=s.createContext({}),d=s.createContext(null);function f(r,e){let{render:t}=s.useContext(d);return u.createElement(u.Fragment,null,t(r,e))}const y=s.forwardRef(f);function x(r,e){var t;let i=r==null?void 0:r.renderDropIndicator,l=r==null||(t=r.isVirtualDragging)===null||t===void 0?void 0:t.call(r),n=s.useCallback(o=>{if(l||e!=null&&e.isDropTarget(o))return i?i(o):u.createElement(y,{target:o})},[e==null?void 0:e.target,l,i]);return r!=null&&r.useDropIndicator?n:void 0}function D(r,e,t){var i,l;let n=r.focusedKey,o=null;if(!(e==null||(i=e.isVirtualDragging)===null||i===void 0)&&i.call(e)&&(t==null||(l=t.target)===null||l===void 0?void 0:l.type)==="item"){o=t.target.key;var a;t.target.dropPosition==="after"&&(o=(a=t.collection.getKeyAfter(o))!==null&&a!==void 0?a:o)}return s.useMemo(()=>new Set([n,o].filter(g=>g!=null)),[n,o])}export{m as $,K as a,d as b,D as c,x as d,c as e};
