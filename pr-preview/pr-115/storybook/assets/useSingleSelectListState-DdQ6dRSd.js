import{$ as D,a as E,b as T}from"./SelectionManager-CB8s_d_z.js";import{r as K}from"./index-BwDkhjyp.js";import{$ as V}from"./useControlledState-DEtK-NO6.js";class C{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(t){let e=this.keyMap.get(t);var l;return e&&(l=e.prevKey)!==null&&l!==void 0?l:null}getKeyAfter(t){let e=this.keyMap.get(t);var l;return e&&(l=e.nextKey)!==null&&l!==void 0?l:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(t){var e;return(e=this.keyMap.get(t))!==null&&e!==void 0?e:null}at(t){const e=[...this.getKeys()];return this.getItem(e[t])}getChildren(t){let e=this.keyMap.get(t);return(e==null?void 0:e.childNodes)||[]}constructor(t){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=t;let e=o=>{if(this.keyMap.set(o.key,o),o.childNodes&&o.type==="section")for(let n of o.childNodes)e(n)};for(let o of t)e(o);let l=null,g=0;for(let[o,n]of this.keyMap)l?(l.nextKey=o,n.prevKey=l.key):(this.firstKey=o,n.prevKey=void 0),n.type==="item"&&(n.index=g++),l=n,l.nextKey=void 0;var r;this.lastKey=(r=l==null?void 0:l.key)!==null&&r!==void 0?r:null}}function W(i){let{filter:t,layoutDelegate:e}=i,l=D(i),g=K.useMemo(()=>i.disabledKeys?new Set(i.disabledKeys):new Set,[i.disabledKeys]),r=K.useCallback(s=>t?new C(t(s)):new C(s),[t]),o=K.useMemo(()=>({suppressTextValueWarning:i.suppressTextValueWarning}),[i.suppressTextValueWarning]),n=E(i,r,o),h=K.useMemo(()=>new T(n,l,{layoutDelegate:e}),[n,l,e]);const c=K.useRef(null);return K.useEffect(()=>{if(l.focusedKey!=null&&!n.getItem(l.focusedKey)&&c.current){const a=c.current.getItem(l.focusedKey),p=[...c.current.getKeys()].map(v=>{const d=c.current.getItem(v);return(d==null?void 0:d.type)==="item"?d:null}).filter(v=>v!==null),u=[...n.getKeys()].map(v=>{const d=n.getItem(v);return(d==null?void 0:d.type)==="item"?d:null}).filter(v=>v!==null);var s,f;const S=((s=p==null?void 0:p.length)!==null&&s!==void 0?s:0)-((f=u==null?void 0:u.length)!==null&&f!==void 0?f:0);var b,$,M;let y=Math.min(S>1?Math.max(((b=a==null?void 0:a.index)!==null&&b!==void 0?b:0)-S+1,0):($=a==null?void 0:a.index)!==null&&$!==void 0?$:0,((M=u==null?void 0:u.length)!==null&&M!==void 0?M:0)-1),x=null,w=!1;for(;y>=0;){if(!h.isDisabled(u[y].key)){x=u[y];break}if(y<u.length-1&&!w)y++;else{w=!0;var k,m;y>((k=a==null?void 0:a.index)!==null&&k!==void 0?k:0)&&(y=(m=a==null?void 0:a.index)!==null&&m!==void 0?m:0),y--}}l.setFocusedKey(x?x.key:null)}c.current=n},[n,h,l,l.focusedKey]),{collection:n,disabledKeys:g,selectionManager:h}}function R(i){var t;let[e,l]=V(i.selectedKey,(t=i.defaultSelectedKey)!==null&&t!==void 0?t:null,i.onSelectionChange),g=K.useMemo(()=>e!=null?[e]:[],[e]),{collection:r,disabledKeys:o,selectionManager:n}=W({...i,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:g,onSelectionChange:c=>{if(c==="all")return;var s;let f=(s=c.values().next().value)!==null&&s!==void 0?s:null;f===e&&i.onSelectionChange&&i.onSelectionChange(f),l(f)}}),h=e!=null?r.getItem(e):null;return{collection:r,disabledKeys:o,selectionManager:n,selectedKey:e,setSelectedKey:l,selectedItem:h}}export{R as $,C as a,W as b};
