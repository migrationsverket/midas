---
sidebar_label: 'Tester'
---

# Tester

Tester i Midas utgörs främst av _komponenttester_ med hjälp av [Vitest Component Testing](https://vitest.dev/guide/browser/component-testing).
Vi gör också automatiska [_tillgänglighetstester_ i Storybook](https://storybook.js.org/docs/writing-tests/accessibility-testing), _snapshottester_ körs i Chromatic.

## Komponenttester

Midas använder [Storybook](https://storybook.js.org), med hjälp av [portable stories](https://storybook.js.org/docs/api/portable-stories/portable-stories-vitest#composestories) kan vi använda en renderad story som utgångspunkt för våra tester.

### Kör komponenttester

```bash
nx test components
```

### Skriva komponenttester

Mycket kan testas på våra komponenter, och mycket kanske redan testas av de bibliotek vi utgår ifrån.
Försök skriva ett test som kompletterar redan skrivna tester, kom ihåg att ditt test kommer behöva underhållas i framtiden.

#### Buggrättning med TDD

Om du rättar en bugg erbjuds du ett unikt tillfälle att skriva ett test som återskapar din bug, förhoppningsvis kommer vi då inte att återinföra buggen.

```tsx title="TextField.spec.tsx"
it('should be impossible to exceed the max length', async () => {
  // Rendera din story
  const { getByRole } = await render(<Primary maxLength={3} />)

  // Interagera med userEvent
  await userEvent.tab()
  await userEvent.keyboard('abcd')

  // Skriv minst en förväntning med expect
  await expect.element(getByRole('textbox')).toHaveDisplayValue('abc')
})
```

Nu kan du åtgärda din bug, när du är klar bör ditt test passera.

## Tillgänglighetstester

Med [@storybook/addon-a11y](https://storybook.js.org/docs/writing-tests/accessibility-testing) utförs tillgänglighetstester med [axe](https://www.deque.com/axe/) på varje komponent, dessa testas i våra workfows med kommandot:

```bash
nx a11y storybook
```

Automatiserade tillgänglighetstester fångar upp en stor del av brister gentemot [WCAG](https://www.w3.org/WAI/standards-guidelines/wcag/)-standarden men kan självklart kompletteras.

För att kontrollera tillgängligheten i dark-mode eller forced-colors, kör: `nx run storybook:a11y-dark-mode` respektive `nx run storybook:a11y-forced-colors`.

## Snapshottester

Vi använder [Chromatic](https://chromatic.com) för att köra snapshottester som jämför visuella ändringar i komponenter.
Chromatic utgår från vår Storybook och tar snapshots på samtliga stories.

### Trigga snapshottester

Snapshottester körs automatiskt vid push till följande brancher:

- `main`
- brancher som startar med `feature`
- brancher som startar med `feat`
- brancher som startar med `fix`
- brancher som startar med `bugfix`

### Hoppa över stories

För att reducera antalet snapshots bör vi bara ta en snap per tillstånd i en komponent, vänligen använd följande kod om du vill att chromatic ska hoppa över din story:

```tsx
export const PrimaryWithAnotherLabel: Story = {
  args: {
    label: 'Just another label',
  },
  parameters: {
    chromatic: {
      disableSnapshot: true,
    },
  },
  // ...
}
```
