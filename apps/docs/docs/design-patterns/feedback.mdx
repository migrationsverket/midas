import {
  InactiveButtonExample,
  ButtonInfobannerExample,
  ErrorMessageListExample,
  DisabledButtonExample,
} from '@site/src/components/examples/feedback-pattern/FeedbackExamples'

# Återkoppling

Detta mönster beskriver hur vi hanterar användarhandlingar i våra gränssnitt/system. Mönstret definierar tre olika typer av handlingar och hur systemen agerar i respektive fall.
Detta mönster definierar:

- vilka typer av handlingar som finns
- hur vi bekräftar användarens intention
- hur fel, vägledning och förklaringar kommuniceras

## Handlingar

### Definition

Vi använder handling för att beskriva ett medvetet initiativ av användaren för att få systemet att göra något. Handlingar utförs typiskt av knappar eller menyalternativ.

En handling

- är initierad av användaren
- har ett tydligt syfte eller resultat
- påverkar vad som händer i systemet
- kräver ett svar från systemet

### Typer av Handlingar

Vi skiljer mellan tre sorters handlingar:

- [Efterhandsutvärderade handlingar](#efterhandsutvärderade-handlingar): handlingar som alltid är möjliga att utföra och systemet sedan utvärderar
- [Förutsättningsstyrda handlingar](#förutsättningsstyrda-handlingar): handlingar som kräver specifika förutsättningar för att kunna göras
- [Otillgängliga handlingar](#otillgänglig-handling): handlingar som inte är möjliga att göra

### Från handling till återkoppling

Interaktionen följer alltid samma logik:

1. Användaren försöker utföra en handling
2. Handlingstypen avgör **om och när utförande kan ske**
3. Ett återkopplingsmönster avgör **hur systemet svarar användaren**

## Efterhandsutvärderade handlingar

Denna sortens handling utförs alltid när den initieras av användaren. Därefter utvärderar systemet resultatet genom validering eller affärslogik. Fel eller saknade förutsättningar kommuniceras efter försök, inte genom att hindra handlingen.
Användarupplevelsen är: ”Jag utförde åtgärden, och systemet talade om vad som gick fel eller rätt.”

### Princip

Vi tillåter handlingen och berättar sedan hur det gick

### Användsningsfall

- Vid formulärinlämning
- Vid sparande av data

### Krav på återkoppling

- Resultatet ska kommuniceras tydligt
- Felen ska kopplas till relevant innehåll/kontroller och vara tillgängliga för hjälpmedel

### Mönster för återkoppling

I formulär, tex etjänster, använder vi oss av en felmeddelandelista för att visa eventuella fel som användaren måste rätta till. Felmeddelandelistan är inte någon egen komponent utan består av en [Infobanner](/components/info-banner) med ankarlänkar till de komponenter som behöver rättas till. Länkarnas text ska vara felmeddelandet från komponeterna med valideringsfel.

<ErrorMessageListExample />

## Förutsättningsstyrda handlingar

En förutsättningsstyrd handling är endast möjlig att utföra när vissa krav är uppfyllda. Om kraven inte är uppfyllda ska handlingen inte kunna utföras, men användaren ska få tydlig vägledning om vad som krävs.
Användarupplevelsen är: ”Jag försökte utföra åtgärden och fick direkt veta vad jag behöver göra först.”

### Princip:

Vi tillåter inte handlingen utan förklarar istället förutsättningarna för att det ska vara möjligt

### Användningsfall

- När det inte är meningsfullt att utföra handlingen om inte kraven är uppfyllda
- När ett minsta antal val krävs (t.ex. markera minst ett objekt)

### Krav på återkoppling

- Triggerkomponenten ska vara synlig och möjlig att aktivera
- återkopplingen ska vara omedelbar
- återkoppling ska vara tillgänglig även för skärmläsaranvändare
- det ska tydligt framgå vad som saknas och hur användaren går vidare

### Mönster för återkoppling

För att uppfylla ovanstående krav har vi tagit fram ett mönster där vi låter knappen vara aktiv men när kraven inte är uppfyllda så:

- sätter vi trigger som aria-disabled för att indikera för skärmläsaranvändare att knappen är inaktiv
- visar en tooltip vid hover för att förklara varför knappen är inaktiv. Den läses även upp av skämläsare
- tar bort onPress-händelsen för att förhindra handlingen

<InactiveButtonExample />

Vi kan även uppfylla kraven genom att visa en infobanner eller en modal med information om hur användaren ska gå vidare, som i nedanstående exempel.

<ButtonInfobannerExample />

## Otillgänglig handling

En otillgänglig åtgärd är en handling som användaren inte kan utföras i aktuell kontext och där användaren själv inte kan uppfylla kraven för att handlingen ska vara möjlig.
Användaren upplever att: ”Den här handlingen är möjlig, men är inte tillgänglig för mig just nu.”

### Princip

Vi blockerar handlingen och berättar varför det inte är möjligt att göra den

### Användningsfall

- När användaren inte har tillräckligt hög behörighetsnivå
- När funktionalitet är avstängd

### Krav på återkoppling

- En förklaring ska alltid finnas i direkt anslutning till triggerkomponenten
- Förklaringen ska vara tillgänglig utan hover
- Språket ska vara neutralt och icke skuldbeläggande

### Mönster för återkoppling

Vi avänder disabled state.

<DisabledButtonExample />
