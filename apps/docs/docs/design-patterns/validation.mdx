import { Grid, GridItem, TextField } from '@midas-ds/components'

import useBaseUrl from '@docusaurus/useBaseUrl'
import ThemedImage from '@theme/ThemedImage'

# Validering i formulär

Validering ska hjälpa våra användare att fylla i formulär rätt. Syftet är att ge tydlig återkoppling vid fel och samtidigt underlätta för användaren att rätta till dessa. Alla inmatningskomponenter har ett felmeddelande som kan visas vid valideringsfel. Felmeddelandet kan visas antingen ovanför eller under fältet. Som standard visas felmeddelandet ovanför fältet och det är detta vi rekommenderar eftersom det blir en logisk läsordning.

<div className='card'>
  <Grid>
    <GridItem size={6}>
      <TextField
        label='Ange förnamn'
        errorMessage={'Du måste ange ett förnamn'}
        isInvalid='true'
        errorPosition='top'
      />
    </GridItem>
    <GridItem size={6}>
      <TextField
        label='Ange förnamn'
        errorMessage={'Du måste ange ett förnamn'}
        isInvalid='true'
        errorPosition='bottom'
      />
    </GridItem>
  </Grid>
</div>

## När och hur ska vi validera?

För att undvika att användaren blir överväldigad av felmeddelanden krävs att vi har en balans mellan att ge snabb återkoppling och låta användaren jobba ostört. Vissa fält ska ge omedelbar feedback när användaren lämnar dem, medan andra bara ska valideras vid efter att formuläret skickats.

### Fält som är obligatoriska men inte kan valideras mot format

Fält som användaren måste fylla i men inte har ett bestämt format eller regel valideras efter att användaren försökt skicka in formuläret.

Exempel: Namn, fritextfält

Motivering: Det finns inget "fel" förrän fältet är tomt vid inskick. Att validera dessa fält när användaren lämnar dem här riskerar att ge onödig stress och distraktion.

### Fält med validerbart format eller regel

Fält där vi har ett bestämt format eller regel valideras när användaren lämnat fältet. När användaren har rättat felet så återgår fältet till ursprungsläget och har inte längre något felmeddelande.

Exempel: e-postadress, telefonnummer, organisationsnummer/personnummer och postnummer

Motivering: Eftersom vi direkt kan avgöra om värdet är ogiltigt kan vi snabbt ge feedback, vilket sparar tid för användaren och förhindrar fel längre fram.

<div className='card'>
  <TextField
    type='email'
    label='Ange din epostadress'
    description='Ange den epost du vill använda för att kommunicera med Migrationsverket'
    errorMessage={'Du måste ha @ och domän med i din epostadress'}
    errorPosition='top'
  />
</div>

### Fält som kräver kontroll mot databas eller extern källa

Fält som kontrolleras mot databas eller extern källa valideras efter användaren lämnat fältet. [Visa en spinner om systemet behöver ladda.](./page-loading.mdx)

Exempel: Kontollera om kortnummer är giltigt

## Felmeddelandelista

I externa tjänster, tex e-ansökningar, som primärt är formulär som användaren ska fylla i, använder vi `Felmeddelandelista` för att visa felen som kvarstår efter att formuläret skickats in. Felmeddelandelistan är inte någon egen komponent utan består av en [Infobanner](/components/info-banner) med ankarlänkar till de komponenter som behöver rättas till.

<ErrorMessageList />

export function ErrorMessageList() {
  const lightSrc = useBaseUrl('/img/error-message-list-light.svg');
  const darkSrc = useBaseUrl('/img/error-message-list-dark.svg');

return (

<ThemedImage
  alt='Felmeddelandelista'
  sources={{
    light: lightSrc,
    dark: darkSrc,
  }}
/>
); }

### Riktlinjer

- Visa Felmeddelandelistan ovanför formuläret
- Länkarnas text ska vara felmeddelandet från komponeterna med valideringsfel.

## Riktlinjer för felmeddelandet

- Försök så långt det går att beskriva användaren ska göra för att det ska bli rätt. Undvik att skriva generiska felmeddelanden som ”fel format”.
- Undvik teknisk jargong och använd ett språk som användare förstår och känner igen.
- Använd en positiv och en icke dömande ton, undvik att skylla på eller antyda att användaren har gjort fel. Undvik till exempel ord som ogiltigt, otillåtet eller felaktigt.
- Använd samma ord i felmeddelandet som i övriga användargränssnittet.
