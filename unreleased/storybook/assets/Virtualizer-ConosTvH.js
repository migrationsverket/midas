import{f as V}from"./SelectionManager-BolOecg_.js";import{f as j,m as B}from"./Collection-CN50Bts9.js";import{r as f,c as K,e as b}from"./iframe-B-ofqC-h.js";import{d as L,g as G}from"./utils-DxoKKY_-.js";import{r as E}from"./index-DYBrUDZy.js";import{$ as J}from"./useResizeObserver-Y7WNE56W.js";import{$ as M}from"./useEvent-Ii72zYm_.js";class Q{shouldInvalidate(e,t){return e.width!==t.width||e.height!==t.height}shouldInvalidateLayoutOptions(e,t){return e!==t}update(e){}getItemRect(e){var t,i;return(i=(t=this.getLayoutInfo(e))===null||t===void 0?void 0:t.rect)!==null&&i!==void 0?i:null}getVisibleRect(){return this.virtualizer.visibleRect}constructor(){this.virtualizer=null}}class x{copy(){let e=new x(this.type,this.key,this.rect.copy());return e.estimatedSize=this.estimatedSize,e.opacity=this.opacity,e.transform=this.transform,e.parentKey=this.parentKey,e.content=this.content,e.isSticky=this.isSticky,e.zIndex=this.zIndex,e.allowOverflow=this.allowOverflow,e}constructor(e,t,i){this.type=e,this.key=t,this.parentKey=null,this.content=null,this.rect=i,this.estimatedSize=!1,this.isSticky=!1,this.opacity=1,this.transform=null,this.zIndex=0,this.allowOverflow=!1}}class I{copy(){return new I(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}isOrigin(){return this.x===0&&this.y===0}constructor(e=0,t=0){this.x=e,this.y=t}}class g{get maxX(){return this.x+this.width}get maxY(){return this.y+this.height}get area(){return this.width*this.height}get topLeft(){return new I(this.x,this.y)}get topRight(){return new I(this.maxX,this.y)}get bottomLeft(){return new I(this.x,this.maxY)}get bottomRight(){return new I(this.maxX,this.maxY)}intersects(e){return this.area>0&&e.area>0&&this.x<=e.x+e.width&&e.x<=this.x+this.width&&this.y<=e.y+e.height&&e.y<=this.y+this.height}containsRect(e){return this.x<=e.x&&this.y<=e.y&&this.maxX>=e.maxX&&this.maxY>=e.maxY}containsPoint(e){return this.x<=e.x&&this.y<=e.y&&this.maxX>=e.x&&this.maxY>=e.y}getCornerInRect(e){for(let t of["topLeft","topRight","bottomLeft","bottomRight"])if(e.containsPoint(this[t]))return t;return null}equals(e){return e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}pointEquals(e){return this.x===e.x&&this.y===e.y}sizeEquals(e){return this.width===e.width&&this.height===e.height}union(e){let t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),l=Math.max(this.maxX,e.maxX)-t,o=Math.max(this.maxY,e.maxY)-i;return new g(t,i,l,o)}intersection(e){if(!this.intersects(e))return new g(0,0,0,0);let t=Math.max(this.x,e.x),i=Math.max(this.y,e.y);return new g(t,i,Math.min(this.maxX,e.maxX)-t,Math.min(this.maxY,e.maxY)-i)}copy(){return new g(this.x,this.y,this.width,this.height)}constructor(e=0,t=0,i=0,l=0){this.x=e,this.y=t,this.width=i,this.height=l}}class z{copy(){return new z(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}get area(){return this.width*this.height}constructor(e=0,t=0){this.width=Math.max(e,0),this.height=Math.max(t,0)}}let Z=0;class q{prepareForReuse(){this.content=null,this.rendered=null,this.layoutInfo=null}getReusableView(e){let t=this.reusableViews.get(e);return t&&t.length>0?t.shift():new te(this.virtualizer,this,e)}reuseChild(e){e.prepareForReuse();let t=this.reusableViews.get(e.viewType);t||(t=[],this.reusableViews.set(e.viewType,t)),t.push(e)}constructor(e,t){this.virtualizer=e,this.key=++Z,this.viewType=t,this.children=new Set,this.reusableViews=new Map,this.layoutInfo=null,this.content=null,this.rendered=null}}class ee extends q{constructor(e){super(e,"root")}}class te extends q{constructor(e,t,i){super(e,i),this.parent=t}}function ie(s,e){if(s===e)return!0;if(s.size!==e.size)return!1;for(let t of s)if(!e.has(t))return!1;return!0}class le{setVisibleRect(e){let t=performance.now()-this.startTime;t<500&&(e.x!==this.visibleRect.x&&t>0&&(this.velocity.x=(e.x-this.visibleRect.x)/t),e.y!==this.visibleRect.y&&t>0&&(this.velocity.y=(e.y-this.visibleRect.y)/t)),this.startTime=performance.now(),this.visibleRect=e}getOverscannedRect(){let e=this.visibleRect.copy(),t=this.visibleRect.height/3;if(e.height+=t,this.velocity.y<0&&(e.y-=t),this.velocity.x!==0){let i=this.visibleRect.width/3;e.width+=i,this.velocity.x<0&&(e.x-=i)}return e}constructor(){this.startTime=0,this.velocity=new I(0,0),this.visibleRect=new g}}class oe{isPersistedKey(e){if(this.persistedKeys.has(e))return!0;for(let t of this.persistedKeys)for(;t!=null;){let i=this.layout.getLayoutInfo(t);if(!i||i.parentKey==null)break;if(t=i.parentKey,t===e)return!0}return!1}getParentView(e){return e.parentKey!=null?this._visibleViews.get(e.parentKey):this._rootView}getReusableView(e){let i=this.getParentView(e).getReusableView(e.type);return i.layoutInfo=e,this._renderView(i),i}_renderView(e){if(e.layoutInfo){let{type:t,key:i,content:l}=e.layoutInfo;e.content=l||this.collection.getItem(i),e.rendered=this._renderContent(t,e.content)}}_renderContent(e,t){let i=t!=null?this._renderedContent.get(t):null;if(i!=null)return i;let l=this.delegate.renderView(e,t);return t&&this._renderedContent.set(t,l),l}keyAtPoint(e){let t=new g(e.x,e.y,1,1),i=t.area===0?[]:this.layout.getVisibleLayoutInfos(t);for(let l of i)if(l.rect.intersects(t))return l.key;return null}relayout(e={}){this.layout.update(e),this.contentSize=this.layout.getContentSize();let t=this.visibleRect,i=e.contentChanged?0:t.x,l=e.contentChanged?0:t.y;if(i=Math.max(0,Math.min(this.contentSize.width-t.width,i)),l=Math.max(0,Math.min(this.contentSize.height-t.height,l)),i!==t.x||l!==t.y){let o=new g(i,l,t.width,t.height);this.delegate.setVisibleRect(o)}else this.updateSubviews()}getVisibleLayoutInfos(){let e;e=this._overscanManager.getOverscannedRect();let t=this.layout.getVisibleLayoutInfos(e),i=new Map;for(let l of t)i.set(l.key,l);return i}updateSubviews(){let e=this.getVisibleLayoutInfos(),t=new Set;for(let[i,l]of this._visibleViews){let o=e.get(i);(!o||l.parent!==this.getParentView(o))&&(this._visibleViews.delete(i),l.parent.reuseChild(l),t.add(l))}for(let[i,l]of e){let o=this._visibleViews.get(i);if(!o)o=this.getReusableView(l),o.parent.children.add(o),this._visibleViews.set(i,o),t.delete(o);else{o.layoutInfo=l;let n=this.collection.getItem(l.key);o.content!==n&&(o.content!=null&&this._renderedContent.delete(o.content),this._renderView(o))}}for(let i of t)i.parent.children.delete(i),i.parent.reusableViews.clear();if(!this._isScrolling)for(let i of e.keys()){let l=this._visibleViews.get(i);l.parent.children.delete(l),l.parent.children.add(l)}}render(e){let t=this,i=!1,l=!1,o=!1,n=!1,a=!1,h=!1;return e.collection!==this.collection&&(t.collection=e.collection,i=!0),(e.layout!==this.layout||this.layout.virtualizer!==this)&&(this.layout&&(this.layout.virtualizer=null),e.layout.virtualizer=this,t.layout=e.layout,i=!0),e.persistedKeys&&!ie(e.persistedKeys,this.persistedKeys)&&(t.persistedKeys=e.persistedKeys,h=!0),this.visibleRect.equals(e.visibleRect)||(this._overscanManager.setVisibleRect(e.visibleRect),this.layout.shouldInvalidate(e.visibleRect,this.visibleRect)?(l=!e.visibleRect.pointEquals(this.visibleRect),o=!e.visibleRect.sizeEquals(this.visibleRect),i=!0):h=!0,t.visibleRect=e.visibleRect),e.invalidationContext!==this._invalidationContext&&(e.invalidationContext&&(o||(o=e.invalidationContext.sizeChanged||!1),l||(l=e.invalidationContext.offsetChanged||!1),n||(n=e.invalidationContext.itemSizeChanged||!1),a||(a=e.invalidationContext.layoutOptions!=null&&this._invalidationContext.layoutOptions!=null&&e.invalidationContext.layoutOptions!==this._invalidationContext.layoutOptions&&this.layout.shouldInvalidateLayoutOptions(e.invalidationContext.layoutOptions,this._invalidationContext.layoutOptions)),i||(i=n||o||l||a)),this._invalidationContext=e.invalidationContext),e.isScrolling!==this._isScrolling&&(this._isScrolling=e.isScrolling,e.isScrolling||(h=!0)),i?this.relayout({offsetChanged:l,sizeChanged:o,itemSizeChanged:n,layoutOptionsChanged:a,layoutOptions:this._invalidationContext.layoutOptions}):h&&this.updateSubviews(),Array.from(this._rootView.children)}getVisibleView(e){return this._visibleViews.get(e)}invalidate(e){this.delegate.invalidate(e)}updateItemSize(e,t){if(!this.layout.updateItemSize)return;this.layout.updateItemSize(e,t)&&this.invalidate({itemSizeChanged:!0})}constructor(e){this.delegate=e.delegate,this.collection=e.collection,this.layout=e.layout,this.contentSize=new z,this.visibleRect=new g,this.persistedKeys=new Set,this._visibleViews=new Map,this._renderedContent=new WeakMap,this._rootView=new ee(this),this._isScrolling=!1,this._invalidationContext={},this._overscanManager=new le}}function ne(s){let[e,t]=f.useState(new g(0,0,0,0)),[i,l]=f.useState(!1),[o,n]=f.useState({}),a=f.useRef(!1),[h]=f.useState(()=>new oe({collection:s.collection,layout:s.layout,delegate:{setVisibleRect(p){t(p),a.current=!0},renderView:s.renderView,invalidate:n}}));L(()=>{a.current&&(a.current=!1,s.onVisibleRectChange(e))});let r=f.useMemo(()=>s.layoutOptions!=null?{...o,layoutOptions:s.layoutOptions}:o,[o,s.layoutOptions]),d=h.render({layout:s.layout,collection:s.collection,persistedKeys:s.persistedKeys,layoutOptions:s.layoutOptions,visibleRect:e,invalidationContext:r,isScrolling:i}),u=h.contentSize,c=f.useCallback(()=>{l(!0)},[]),y=f.useCallback(()=>{l(!1)},[]);return f.useMemo(()=>({virtualizer:h,visibleViews:d,setVisibleRect:t,contentSize:u,isScrolling:i,startScrolling:c,endScrolling:y}),[h,d,t,u,i,c,y])}const S=48;class Ie extends Q{get collection(){return this.virtualizer.collection}getLayoutInfo(e){var t;return this.ensureLayoutInfo(e),((t=this.layoutNodes.get(e))===null||t===void 0?void 0:t.layoutInfo)||null}getVisibleLayoutInfos(e){if(e.height>1){var t,i;let n=((i=(t=this.rowHeight)!==null&&t!==void 0?t:this.estimatedRowHeight)!==null&&i!==void 0?i:S)+this.gap;e.y=Math.floor(e.y/n)*n,e.height=Math.ceil(e.height/n)*n}this.layoutIfNeeded(e);let l=[],o=n=>{for(let a of n)this.isVisible(a,e)&&(l.push(a.layoutInfo),a.children&&o(a.children))};return o(this.rootNodes),l}layoutIfNeeded(e){if(this.lastCollection){this.requestedRect.containsRect(e)||(this.requestedRect=this.requestedRect.union(e),this.rootNodes=this.buildCollection());for(let t of this.virtualizer.persistedKeys)if(this.ensureLayoutInfo(t))return}}ensureLayoutInfo(e){return!this.layoutNodes.has(e)&&this.requestedRect.area<this.contentSize.area&&this.lastCollection?(this.requestedRect=new g(0,0,1/0,1/0),this.rootNodes=this.buildCollection(),this.requestedRect=new g(0,0,this.contentSize.width,this.contentSize.height),!0):!1}isVisible(e,t){return e.layoutInfo.rect.intersects(t)||e.layoutInfo.isSticky||e.layoutInfo.type==="header"||e.layoutInfo.type==="loader"||this.virtualizer.isPersistedKey(e.layoutInfo.key)}shouldInvalidateEverything(e){let t=e.layoutOptions;var i,l,o,n,a;return e.sizeChanged||this.rowHeight!==((i=t==null?void 0:t.rowHeight)!==null&&i!==void 0?i:this.rowHeight)||this.headingHeight!==((l=t==null?void 0:t.headingHeight)!==null&&l!==void 0?l:this.headingHeight)||this.loaderHeight!==((o=t==null?void 0:t.loaderHeight)!==null&&o!==void 0?o:this.loaderHeight)||this.gap!==((n=t==null?void 0:t.gap)!==null&&n!==void 0?n:this.gap)||this.padding!==((a=t==null?void 0:t.padding)!==null&&a!==void 0?a:this.padding)}shouldInvalidateLayoutOptions(e,t){return e.rowHeight!==t.rowHeight||e.estimatedRowHeight!==t.estimatedRowHeight||e.headingHeight!==t.headingHeight||e.estimatedHeadingHeight!==t.estimatedHeadingHeight||e.loaderHeight!==t.loaderHeight||e.dropIndicatorThickness!==t.dropIndicatorThickness||e.gap!==t.gap||e.padding!==t.padding}update(e){let t=this.virtualizer.collection;this.invalidateEverything=this.shouldInvalidateEverything(e),this.invalidateEverything&&(this.requestedRect=this.virtualizer.visibleRect.copy(),this.layoutNodes.clear());let i=e.layoutOptions;var l;this.rowHeight=(l=i==null?void 0:i.rowHeight)!==null&&l!==void 0?l:this.rowHeight;var o;this.estimatedRowHeight=(o=i==null?void 0:i.estimatedRowHeight)!==null&&o!==void 0?o:this.estimatedRowHeight;var n;this.headingHeight=(n=i==null?void 0:i.headingHeight)!==null&&n!==void 0?n:this.headingHeight;var a;this.estimatedHeadingHeight=(a=i==null?void 0:i.estimatedHeadingHeight)!==null&&a!==void 0?a:this.estimatedHeadingHeight;var h;this.loaderHeight=(h=i==null?void 0:i.loaderHeight)!==null&&h!==void 0?h:this.loaderHeight;var r;this.dropIndicatorThickness=(r=i==null?void 0:i.dropIndicatorThickness)!==null&&r!==void 0?r:this.dropIndicatorThickness;var d;this.gap=(d=i==null?void 0:i.gap)!==null&&d!==void 0?d:this.gap;var u;if(this.padding=(u=i==null?void 0:i.padding)!==null&&u!==void 0?u:this.padding,this.rootNodes=this.buildCollection(),this.lastCollection&&t!==this.lastCollection)for(let c of this.lastCollection.getKeys())t.getItem(c)||this.layoutNodes.get(c)&&this.layoutNodes.delete(c);this.lastCollection=t,this.invalidateEverything=!1,this.validRect=this.requestedRect.copy()}buildCollection(e=this.padding){let t=this.virtualizer.collection,i=[...t],l=i.filter(r=>r.type==="loader"),o=[],n=(t==null?void 0:t.size)===0;n&&(e=0);for(let r of i){var a,h;let d=((h=(a=this.rowHeight)!==null&&a!==void 0?a:this.estimatedRowHeight)!==null&&h!==void 0?h:S)+this.gap;if(r.type==="item"&&e+d<this.requestedRect.y&&!this.isValid(r,e)){e+=d;continue}let u=this.buildChild(r,this.padding,e,null);if(e=u.layoutInfo.rect.maxY+this.gap,o.push(u),r.type==="loader"){let c=l.indexOf(r);l.splice(c,1)}if((r.type==="item"||r.type==="loader")&&e>this.requestedRect.maxY){let c=i.indexOf(r);for(let y of l){let v=i.indexOf(y);e+=(v-c-1)*d;let p=this.buildChild(y,this.padding,e,null);o.push(p),e=p.layoutInfo.rect.maxY,c=v}e+=(i.length-c-1)*d;break}}return e-=this.gap,e+=n?0:this.padding,this.contentSize=new z(this.virtualizer.visibleRect.width,e),o}isValid(e,t){let i=this.layoutNodes.get(e.key);return!this.invalidateEverything&&!!i&&i.node===e&&t===i.layoutInfo.rect.y&&i.layoutInfo.rect.intersects(this.validRect)&&i.validRect.containsRect(i.layoutInfo.rect.intersection(this.requestedRect))}buildChild(e,t,i,l){if(this.isValid(e,i))return this.layoutNodes.get(e.key);let o=this.buildNode(e,t,i);return o.layoutInfo.parentKey=l??null,o.layoutInfo.allowOverflow=!0,this.layoutNodes.set(e.key,o),o}buildNode(e,t,i){switch(e.type){case"section":return this.buildSection(e,t,i);case"item":return this.buildItem(e,t,i);case"header":return this.buildSectionHeader(e,t,i);case"loader":return this.buildLoader(e,t,i);case"separator":return this.buildItem(e,t,i);default:throw new Error("Unsupported node type: "+e.type)}}buildLoader(e,t,i){let l=new g(t,i,this.padding,0),o=new x("loader",e.key,l);l.width=this.virtualizer.contentSize.width-this.padding-t;var n,a,h;return l.height=e.props.isLoading?(h=(a=(n=this.loaderHeight)!==null&&n!==void 0?n:this.rowHeight)!==null&&a!==void 0?a:this.estimatedRowHeight)!==null&&h!==void 0?h:S:0,{layoutInfo:o,validRect:l.intersection(this.requestedRect)}}buildSection(e,t,i){let l=this.virtualizer.collection,o=this.virtualizer.visibleRect.width-this.padding,n=new g(t,i,o-t,0),a=new x(e.type,e.key,n),h=i,r=0,d=[];for(let y of V(e,l)){var u,c;let v=((c=(u=this.rowHeight)!==null&&u!==void 0?u:this.estimatedRowHeight)!==null&&c!==void 0?c:S)+this.gap;if(i+v<this.requestedRect.y&&!this.isValid(e,i)){i+=v,r++;continue}let p=this.buildChild(y,t,i,a.key);if(i=p.layoutInfo.rect.maxY+this.gap,d.push(p),i>this.requestedRect.maxY){i+=([...V(e,l)].length-(d.length+r))*v;break}}return i-=this.gap,n.height=i-h,{layoutInfo:a,children:d,validRect:a.rect.intersection(this.requestedRect),node:e}}buildSectionHeader(e,t,i){let l=this.virtualizer.visibleRect.width-this.padding,o=this.headingHeight,n=!1;if(o==null){let r=this.layoutNodes.get(e.key),d=r==null?void 0:r.layoutInfo;if(d){let u=this.virtualizer.collection.getItem(e.key),c=this.lastCollection?this.lastCollection.getItem(e.key):null;o=d.rect.height,n=l!==d.rect.width||u!==c||d.estimatedSize}else o=e.rendered?this.estimatedHeadingHeight:0,n=!0}o==null&&(o=S);let a=new g(t,i,l-t,o),h=new x("header",e.key,a);return h.estimatedSize=n,{layoutInfo:h,children:[],validRect:h.rect.intersection(this.requestedRect),node:e}}buildItem(e,t,i){let l=this.virtualizer.visibleRect.width-this.padding-t,o=this.rowHeight,n=!1;if(o==null){let r=this.layoutNodes.get(e.key);r?(o=r.layoutInfo.rect.height,n=l!==r.layoutInfo.rect.width||e!==r.node||r.layoutInfo.estimatedSize):(o=this.estimatedRowHeight,n=!0)}o==null&&(o=S);let a=new g(t,i,l,o),h=new x(e.type,e.key,a);return h.estimatedSize=n,{layoutInfo:h,children:[],validRect:h.rect,node:e}}updateItemSize(e,t){let i=this.layoutNodes.get(e);if(!i)return!1;let l=this.virtualizer.collection,o=i.layoutInfo;if(o.estimatedSize=!1,o.rect.height!==t.height){let n=o.copy();n.rect.height=t.height,i.layoutInfo=n,this.validRect.height=Math.min(this.validRect.height,o.rect.y-this.validRect.y),this.requestedRect.height+=n.rect.height-o.rect.height,this.updateLayoutNode(e,o,n);let a=o.parentKey!=null?l.getItem(o.parentKey):null;for(;a;)this.updateLayoutNode(a.key,o,n),a=a.parentKey!=null?l.getItem(a.parentKey):null;return!0}return!1}updateLayoutNode(e,t,i){let l=this.layoutNodes.get(e);l&&(l.validRect=l.validRect.intersection(this.validRect),l.layoutInfo===t&&(l.layoutInfo=i))}getContentSize(){return this.contentSize}getDropTargetFromPoint(e,t,i){e+=this.virtualizer.visibleRect.x,t+=this.virtualizer.visibleRect.y;let l=new g(e,Math.max(0,t-this.gap),1,Math.max(1,this.gap*2)),o=this.getVisibleLayoutInfos(l),n=null,a=1/0;for(let u of o){if(!u.rect.intersects(l))continue;let c=Math.abs(u.rect.y-t),y=Math.abs(u.rect.maxY-t),v=Math.min(c,y);v<a&&(a=v,n=u.key)}if(n==null||this.virtualizer.collection.size===0)return{type:"root"};let h=this.getLayoutInfo(n);if(!h)return null;let r=h.rect,d={type:"item",key:h.key,dropPosition:"on"};return i(d)?t<=r.y+10&&i({...d,dropPosition:"before"})?d.dropPosition="before":t>=r.maxY-10&&i({...d,dropPosition:"after"})&&(d.dropPosition="after"):t<=r.y+r.height/2&&i({...d,dropPosition:"before"})?d.dropPosition="before":i({...d,dropPosition:"after"})&&(d.dropPosition="after"),d}getDropTargetLayoutInfo(e){let t=this.getLayoutInfo(e.key),i;if(e.dropPosition==="before")i=new g(t.rect.x,Math.max(0,t.rect.y-this.dropIndicatorThickness/2),t.rect.width,this.dropIndicatorThickness);else if(e.dropPosition==="after"){let o=this.collection.getItem(e.key);if(o){var l;let n=(l=o.level)!==null&&l!==void 0?l:0,a=this.collection.getKeyAfter(e.key);for(;a!=null;){let h=this.collection.getItem(a);if(!h||h.level<=n)break;t=this.getLayoutInfo(a)||t,a=this.collection.getKeyAfter(a)}}i=new g(t.rect.x,t.rect.maxY-this.dropIndicatorThickness/2,t.rect.width,this.dropIndicatorThickness)}else i=t.rect;return new x("dropIndicator",e.key+":"+e.dropPosition,i)}constructor(e={}){super();var t;this.rowHeight=(t=e.rowHeight)!==null&&t!==void 0?t:null;var i;this.estimatedRowHeight=(i=e.estimatedRowHeight)!==null&&i!==void 0?i:null;var l;this.headingHeight=(l=e.headingHeight)!==null&&l!==void 0?l:null;var o;this.estimatedHeadingHeight=(o=e.estimatedHeadingHeight)!==null&&o!==void 0?o:null;var n;this.loaderHeight=(n=e.loaderHeight)!==null&&n!==void 0?n:null,this.dropIndicatorThickness=e.dropIndicatorThickness||2,this.gap=e.gap||0,this.padding=e.padding||0,this.layoutNodes=new Map,this.rootNodes=[],this.lastCollection=null,this.invalidateEverything=!1,this.validRect=new g,this.requestedRect=new g,this.contentSize=new z}}let $=null;function se(s=!1){if($===null||s){const e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";const i=document.createElement("div"),l=i.style;return l.width="100px",l.height="100px",e.appendChild(i),document.body.appendChild(e),e.scrollLeft>0?$="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?$="negative":$="positive-ascending"),document.body.removeChild(e),$}return $}function re(s,e){let{scrollLeft:t}=s;if(e==="rtl"){let{scrollWidth:i,clientWidth:l}=s;switch(se()){case"negative":t=-t;break;case"positive-descending":t=i-l-t;break}}return t}function ae(s,e){let{contentSize:t,onVisibleRectChange:i,innerStyle:l,onScrollStart:o,onScrollEnd:n,scrollDirection:a="both",...h}=s,r=f.useRef({scrollTop:0,scrollLeft:0,scrollEndTime:0,scrollTimeout:null,width:0,height:0,isScrolling:!1}).current,{direction:d}=K(),[u,c]=f.useState(!1),y=f.useCallback(()=>{r.isScrolling=!1,c(!1),r.scrollTimeout=null,window.dispatchEvent(new Event("tk.connect-observer")),n==null||n()},[r,n]),v=f.useCallback(w=>{w.target===w.currentTarget&&(s.onScroll&&s.onScroll(w),E.flushSync(()=>{let m=w.currentTarget.scrollTop,_=re(w.currentTarget,d);r.scrollTop=Math.max(0,Math.min(m,t.height-r.height)),r.scrollLeft=Math.max(0,Math.min(_,t.width-r.width)),i(new g(r.scrollLeft,r.scrollTop,r.width,r.height)),r.isScrolling||(r.isScrolling=!0,c(!0),window.dispatchEvent(new Event("tk.disconnect-observer")),o&&o());let H=Date.now();!("onscrollend"in window)&&r.scrollEndTime<=H+50&&(r.scrollEndTime=H+300,r.scrollTimeout!=null&&clearTimeout(r.scrollTimeout),r.scrollTimeout=setTimeout(y,300))}))},[s,d,r,t,i,o,y]);M(e,"scroll",v),M(e,"scrollend",y),f.useEffect(()=>()=>{r.scrollTimeout!=null&&clearTimeout(r.scrollTimeout),r.isScrolling&&window.dispatchEvent(new Event("tk.connect-observer"))},[]);let p=f.useRef(!1),C=G(w=>{let m=e.current;if(!m||p.current)return;p.current=!0,Object.getOwnPropertyNames(window.HTMLElement.prototype).includes("clientWidth"),Object.getOwnPropertyNames(window.HTMLElement.prototype).includes("clientHeight");let _=m.clientWidth,H=m.clientHeight,T=_,N=H;(r.width!==T||r.height!==N)&&(r.width=T,r.height=N,w(()=>{i(new g(r.scrollLeft,r.scrollTop,T,N))}),(_!==m.clientWidth||H!==m.clientHeight)&&(r.width=m.clientWidth,r.height=m.clientHeight,w(()=>{i(new g(r.scrollLeft,r.scrollTop,r.width,r.height))}))),p.current=!1}),k=f.useRef(null),[A,F]=f.useState({});L(()=>{if(!p.current&&(k.current==null||!t.equals(k.current)))if(typeof IS_REACT_ACT_ENVIRONMENT=="boolean"?IS_REACT_ACT_ENVIRONMENT:typeof jest<"u"){F({}),k.current=t;return}else queueMicrotask(()=>C(E.flushSync));k.current=t}),L(()=>{C(w=>w())},[A]);let U=f.useCallback(()=>{C(E.flushSync)},[C]);J({ref:e,box:"border-box",onResize:U});let R={padding:0,...h.style};return a==="horizontal"?(R.overflowX="auto",R.overflowY="hidden"):a==="vertical"||t.width===r.width?(R.overflowY="auto",R.overflowX="hidden"):R.overflow="auto",l={width:Number.isFinite(t.width)?t.width:void 0,height:Number.isFinite(t.height)?t.height:void 0,pointerEvents:u?"none":"auto",position:"relative",...l},{isScrolling:u,scrollViewProps:{...h,style:R},contentProps:{role:"presentation",style:l}}}function he(s){let{layoutInfo:e,virtualizer:t,ref:i}=s,l=e==null?void 0:e.key,o=f.useCallback(()=>{if(l!=null&&i.current){let n=de(i.current);t.updateItemSize(l,n)}},[t,l,i]);return L(()=>{e!=null&&e.estimatedSize&&o()}),{updateSize:o}}function de(s){let e=s.style.height;s.style.height="";let t=new z(s.scrollWidth,s.scrollHeight);return s.style.height=e,t}function Y(s){let{style:e,className:t,layoutInfo:i,virtualizer:l,parent:o,children:n}=s,{direction:a}=K(),h=f.useRef(null);return he({layoutInfo:i,virtualizer:l,ref:h}),b.createElement("div",{role:"presentation",ref:h,className:t,style:{...ue(i,a,o),...e}},n)}let O=new WeakMap;function ue(s,e,t){let i=e==="rtl"?"right":"left",l=O.get(s);if(l&&l[i]!=null){if(!t)return l;let h=s.rect.y-t.rect.y,r=s.rect.x-t.rect.x;if(l.top===h&&l[i]===r)return l}let o={top:s.rect.y-(t&&!(t.allowOverflow&&s.isSticky)?t.rect.y:0),[i]:s.rect.x-(t&&!(t.allowOverflow&&s.isSticky)?t.rect.x:0),width:s.rect.width,height:s.rect.height};Object.entries(o).forEach(([h,r])=>{Number.isFinite(r)||(o[h]=void 0)});var n;let a={position:s.isSticky?"sticky":"absolute",display:s.isSticky?"inline-block":void 0,overflow:s.allowOverflow?"visible":"hidden",opacity:s.opacity,zIndex:s.zIndex,transform:(n=s.transform)!==null&&n!==void 0?n:void 0,contain:"size layout style",...o};return O.set(s,a),a}const W=f.createContext(null),X=f.createContext(null);function Re(s){let{children:e,layout:t,layoutOptions:i}=s,l=f.useMemo(()=>typeof t=="function"?new t:t,[t]),o=f.useMemo(()=>({isVirtualized:!0,layoutDelegate:l,dropTargetDelegate:l.getDropTargetFromPoint?l:void 0,CollectionRoot:ce,CollectionBranch:fe}),[l]);return b.createElement(j.Provider,{value:o},b.createElement(X.Provider,{value:{layout:l,layoutOptions:i}},e))}function ce({collection:s,persistedKeys:e,scrollRef:t,renderDropIndicator:i}){var l;let{layout:o,layoutOptions:n}=f.useContext(X),a=(l=o.useLayoutOptions)===null||l===void 0?void 0:l.call(o),h=ne({layout:o,collection:s,renderView:(d,u)=>{var c;return u==null||(c=u.render)===null||c===void 0?void 0:c.call(u,u)},onVisibleRectChange(d){let u=t==null?void 0:t.current;u&&(u.scrollLeft=d.x,u.scrollTop=d.y)},persistedKeys:e,layoutOptions:f.useMemo(()=>n&&a?{...n,...a}:n||a,[n,a])}),{contentProps:r}=ae({onVisibleRectChange:h.setVisibleRect,contentSize:h.contentSize,onScrollStart:h.startScrolling,onScrollEnd:h.endScrolling},t);return b.createElement("div",r,b.createElement(W.Provider,{value:h},D(null,h.visibleViews,i)))}function fe({parent:s,renderDropIndicator:e}){let i=f.useContext(W).virtualizer.getVisibleView(s.key);return D(i,Array.from(i.children),e)}function D(s,e,t){return e.map(i=>ge(s,i,t))}function ge(s,e,t){let i=b.createElement(Y,{key:e.key,layoutInfo:e.layoutInfo,virtualizer:e.virtualizer,parent:s==null?void 0:s.layoutInfo},e.rendered),{collection:l,layout:o}=e.virtualizer,n=e.content;return(n==null?void 0:n.type)==="item"&&t&&o.getDropTargetLayoutInfo&&(i=b.createElement(b.Fragment,{key:e.key},P(s,e,{type:"item",key:e.content.key,dropPosition:"before"},t),i,B(l,n,a=>P(s,e,a,t)))),i}function P(s,e,t,i){let l=i(t);if(l){let o=e.virtualizer.layout.getDropTargetLayoutInfo(t);l=b.createElement(Y,{layoutInfo:o,virtualizer:e.virtualizer,parent:s==null?void 0:s.layoutInfo},l)}return l}export{Ie as $,z as a,g as b,x as c,Re as d};
